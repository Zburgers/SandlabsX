{
  "fileSummary": {
    "generationHeader": "This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.\nThe content has been processed where content has been formatted for parsing in json style.",
    "purpose": "This file contains a packed representation of a subset of the repository's contents that is considered the most important context.\nIt is designed to be easily consumable by AI systems for analysis, code review,\nor other automated processes.",
    "fileFormat": "The content is organized as follows:\n1. This summary section\n2. Repository information\n3. Directory structure\n4. Repository files, each consisting of:\n   - File path as a key\n   - Full contents of the file as the value",
    "usageGuidelines": "- This file should be treated as read-only. Any changes should be made to the\n  original repository files, not this packed version.\n- When processing this file, use the file path to distinguish\n  between different files in the repository.\n- Be aware that this file may contain sensitive information. Handle it with\n  the same level of security as you would the original repository.",
    "notes": "- Some files may have been excluded based on .gitignore rules and Repomix's configuration\n- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files\n- Files matching these patterns are excluded: pgdata/**, **/*.md\n- Files matching patterns in .gitignore are excluded\n- Files matching default ignore patterns are excluded\n- Content has been formatted for parsing in json style\n- Files are sorted by Git change count (files with more changes are at the bottom)"
  },
  "directoryStructure": "backend/\n  modules/\n    guacamoleClient.js\n    nodeManager.js\n    qemuManager.js\n  .env.example\n  .gitignore\n  Dockerfile\n  init-images.sh\n  package.json\n  server.js\n  start-backend.sh\nfrontend/\n  app/\n    globals.css\n    layout.tsx\n    page.tsx\n  components/\n    Button.tsx\n    CreateNodeModal.tsx\n    GuacamoleViewer.tsx\n    NodeCard.tsx\n    StatusBadge.tsx\n  lib/\n    api.ts\n    mockData.ts\n    types.ts\n  .env.example\n  .eslintrc.json\n  Dockerfile\n  next-env.d.ts\n  next.config.js\n  package.json\n  postcss.config.js\n  tailwind.config.js\n  tsconfig.json\nimages/\n  custom/\n    router_1762805489189_1762806979447.qcow2\n    router_1762805489189.qcow2\n    router_1762805489189.vmdk\n  bazzite-gnome-stable-amd64.iso\n  router.vmdk\noverlays/\n  .gitkeep\n.gitignore\n.repomixignore\n.todo_fix_qemu.json\nCHEAT-SHEET.txt\ndocker-compose.yml\ninitdb-schema.sql\nmcp.json\nquick-test.sh\nrun-all.sh\nsetup-all.sh\nstatus.sh\nstop-all.sh\ntest-backend.sh\ntest-bazzite.sh\nverify-images.sh",
  "files": {
    "backend/init-images.sh": "#!/bin/bash\nset -euo pipefail\n\nIMAGES_DIR=\"/images\"\nAUTO_DOWNLOAD=${AUTO_DOWNLOAD_IMAGES:-\"false\"}\n\ndeclare -A IMAGES\nIMAGES[ubuntu-24-lts.qcow2]=\"https://cloud-images.ubuntu.com/releases/24.04/release/ubuntu-24.04-server-cloudimg-amd64.img\"\nIMAGES[alpine-3.qcow2]=\"https://dl-cdn.alpinelinux.org/alpine/latest-stable/releases/x86_64/alpine-standard-3.18.0-x86_64.iso\"\nIMAGES[debian-13.qcow2]=\"https://cdimage.debian.org/cdimage/cloud/bullseye/latest/debian-10-openstack-amd64.qcow2\"\n\nmkdir -p \"$IMAGES_DIR\"\n\nif [ \"$AUTO_DOWNLOAD\" != \"true\" ]; then\n  echo \"Auto-download disabled (AUTO_DOWNLOAD_IMAGES != true). Skipping image download.\"\n  exit 0\nfi\n\necho \"Auto-download enabled. Ensuring base images exist in $IMAGES_DIR\"\n\nfor name in \"${!IMAGES[@]}\"; do\n  dest=\"$IMAGES_DIR/$name\"\n  url=\"${IMAGES[$name]}\"\n  if [ -f \"$dest\" ]; then\n    echo \" - Exists: $dest\"\n    continue\n  fi\n\n  echo \" - Downloading $name from $url\"\n  # Use wget/curl fallback\n  if command -v wget >/dev/null 2>&1; then\n    wget -O \"$dest\" \"$url\" || { echo \"Failed to download $url\"; rm -f \"$dest\"; exit 1; }\n  else\n    curl -fSL \"$url\" -o \"$dest\" || { echo \"Failed to download $url\"; rm -f \"$dest\"; exit 1; }\n  fi\n\n  echo \"   Downloaded: $dest\"\ndone\n\necho \"All requested images are present.\"\n\nexit 0\n#!/bin/bash\n\n# init-images.sh - Initialize base VM images for SandlabX\n# This script downloads cloud-init ready base images if they don't exist\n\nset -e\n\nIMAGES_DIR=\"/images\"\nDOWNLOAD_ENABLED=${AUTO_DOWNLOAD_IMAGES:-\"true\"}\n\necho \"üîç Checking for base VM images in ${IMAGES_DIR}...\"\n\n# Create images directory if it doesn't exist\nmkdir -p \"${IMAGES_DIR}\"\n\n# Base image definitions\ndeclare -A IMAGES=(\n    [\"ubuntu-24-lts.qcow2\"]=\"https://cloud-images.ubuntu.com/noble/current/noble-server-cloudimg-amd64.img\"\n    [\"alpine-3.qcow2\"]=\"https://dl-cdn.alpinelinux.org/alpine/v3.19/releases/cloud/nocloud_alpine-3.19.1-x86_64-uefi-cloudinit-r0.qcow2\"\n    [\"debian-13.qcow2\"]=\"https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-generic-amd64.qcow2\"\n)\n\n# Function to download and verify image\ndownload_image() {\n    local filename=$1\n    local url=$2\n    local filepath=\"${IMAGES_DIR}/${filename}\"\n    \n    echo \"üì• Downloading ${filename}...\"\n    echo \"   URL: ${url}\"\n    \n    # Download with progress\n    if wget -q --show-progress -O \"${filepath}.tmp\" \"${url}\"; then\n        mv \"${filepath}.tmp\" \"${filepath}\"\n        echo \"‚úÖ Downloaded: ${filename}\"\n        \n        # Verify it's a valid qcow2 image\n        if qemu-img info \"${filepath}\" > /dev/null 2>&1; then\n            echo \"‚úÖ Verified: ${filename} is a valid QCOW2 image\"\n            return 0\n        else\n            echo \"‚ùå Invalid image format, removing...\"\n            rm -f \"${filepath}\"\n            return 1\n        fi\n    else\n        echo \"‚ùå Failed to download ${filename}\"\n        rm -f \"${filepath}.tmp\"\n        return 1\n    fi\n}\n\n# Check each base image\nmissing_images=()\nfor image in \"${!IMAGES[@]}\"; do\n    filepath=\"${IMAGES_DIR}/${image}\"\n    \n    if [ -f \"${filepath}\" ]; then\n        echo \"‚úÖ Found: ${image}\"\n        \n        # Verify it's a valid image\n        if qemu-img info \"${filepath}\" > /dev/null 2>&1; then\n            size=$(qemu-img info \"${filepath}\" | grep \"virtual size\" | awk '{print $3, $4}')\n            echo \"   Size: ${size}\"\n        else\n            echo \"‚ö†Ô∏è  Invalid or corrupted: ${image}\"\n            missing_images+=(\"${image}\")\n        fi\n    else\n        echo \"‚ùå Missing: ${image}\"\n        missing_images+=(\"${image}\")\n    fi\ndone\n\n# Download missing images if auto-download is enabled\nif [ ${#missing_images[@]} -gt 0 ]; then\n    if [ \"${DOWNLOAD_ENABLED}\" = \"true\" ]; then\n        echo \"\"\n        echo \"üöÄ Auto-download enabled. Downloading missing images...\"\n        echo \"\"\n        \n        for image in \"${missing_images[@]}\"; do\n            url=\"${IMAGES[${image}]}\"\n            if [ -n \"${url}\" ]; then\n                download_image \"${image}\" \"${url}\" || echo \"‚ö†Ô∏è  Failed to download ${image}, continuing...\"\n            fi\n        done\n    else\n        echo \"\"\n        echo \"‚ö†Ô∏è  Auto-download is disabled (AUTO_DOWNLOAD_IMAGES=false)\"\n        echo \"   Missing images:\"\n        for image in \"${missing_images[@]}\"; do\n            echo \"   - ${image}\"\n            echo \"     URL: ${IMAGES[${image}]}\"\n        done\n        echo \"\"\n        echo \"   To enable auto-download, set AUTO_DOWNLOAD_IMAGES=true\"\n        echo \"   Or manually download images to: ${IMAGES_DIR}\"\n    fi\nfi\n\necho \"\"\necho \"üìä Image Status Summary:\"\necho \"----------------------\"\nfor image in \"${!IMAGES[@]}\"; do\n    filepath=\"${IMAGES_DIR}/${image}\"\n    if [ -f \"${filepath}\" ]; then\n        echo \"‚úÖ ${image}\"\n    else\n        echo \"‚ùå ${image} (VMs with this OS will fail to start)\"\n    fi\ndone\necho \"\"\n\n# Continue even if some images are missing\necho \"‚úÖ Image initialization complete\"\nexit 0",
    "frontend/.eslintrc.json": "{\n  \"extends\": [\n    \"next/core-web-vitals\",\n    \"next/typescript\"\n  ]\n}",
    ".repomixignore": "# .repomixignore\nnode_modules/\n.git/",
    ".todo_fix_qemu.json": "{\n  \"todo\": [\n    {\"id\": 1, \"title\": \"Inspect compose & backend code\", \"status\": \"completed\", \"description\": \"Opened docker-compose.yml, backend/Dockerfile, and backend/modules/qemuManager.js and searched for VNC/guacamole integration.\"},\n  {\"id\": 2, \"title\": \"Install QEMU in backend image\", \"status\": \"in-progress\", \"description\": \"Updated backend/Dockerfile to use Debian image and install QEMU packages via apt.\"},\n  {\"id\": 3, \"title\": \"Ensure images available inside container\", \"status\": \"in-progress\", \"description\": \"Added init-images.sh to download base images into /images when AUTO_DOWNLOAD_IMAGES=true; compose mounts ./images into container.\"},\n    {\"id\": 4, \"title\": \"Optional: expose VNC ports & KVM\", \"status\": \"not-started\", \"description\": \"Consider enabling /dev/kvm or host networking and expose VNC if desired for guacd to connect.\"},\n    {\"id\": 5, \"title\": \"Rebuild and test\", \"status\": \"not-started\", \"description\": \"Rebuild backend image and run docker-compose up; verify qemu-img exists and overlays created, then test Guacamole connections.\"}\n  ]\n}",
    "test-bazzite.sh": "#!/bin/bash\n# Test Bazzite VM with Guacamole after installation\n\necho \"=== Bazzite VM Test ===\"\n\n# Stop the installation VM\necho \"1. Stopping installation VM...\"\npkill -f \"bazzite.*iso\"\n\n# Start services\necho \"2. Starting Docker services...\"\ncd /home/naki/Desktop/itsthatnewshit/sandboxlabs\ndocker compose up -d\n\nsleep 5\n\n# Create Bazzite node via API\necho \"3. Creating Bazzite node...\"\ncurl -X POST http://localhost:3001/api/nodes \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\":\"bazzite-test\",\"osType\":\"bazzite\",\"resources\":{\"memory\":\"4096\",\"cpus\":\"2\"}}'\n\necho \"\"\necho \"4. Listing nodes...\"\ncurl -s http://localhost:3001/api/nodes | jq .\n\necho \"\"\necho \"=== Next Steps ===\"\necho \"1. Find your node ID from the list above\"\necho \"2. Run the node: curl -X POST http://localhost:3001/api/nodes/YOUR_NODE_ID/run\"\necho \"3. Access Guacamole: http://localhost:8081/guacamole\"",
    "verify-images.sh": "#!/bin/bash\n# Image Format Verification Script\n# Tests QCOW2 conversion and compatibility\n\nset -e\n\nSCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)\"\nIMAGES_DIR=\"$SCRIPT_DIR/images\"\nCUSTOM_DIR=\"$IMAGES_DIR/custom\"\n\necho \"=========================================\"\necho \"SandLabX Image Format Verification\"\necho \"=========================================\"\necho \"\"\n\n# Colors\nGREEN='\\033[0;32m'\nRED='\\033[0;31m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m' # No Color\n\ncheck_command() {\n    if command -v \"$1\" &> /dev/null; then\n        echo -e \"${GREEN}‚úì${NC} $1 found\"\n        return 0\n    else\n        echo -e \"${RED}‚úó${NC} $1 not found\"\n        return 1\n    fi\n}\n\necho \"Checking prerequisites...\"\ncheck_command qemu-img || exit 1\ncheck_command file || exit 1\necho \"\"\n\necho \"Scanning images directory...\"\necho \"Location: $IMAGES_DIR\"\necho \"\"\n\n# Check main images\nif [ -d \"$IMAGES_DIR\" ]; then\n    echo \"=== Main Images ===\"\n    shopt -s nullglob\n    for img in \"$IMAGES_DIR\"/*.qcow2 \"$IMAGES_DIR\"/*.vmdk \"$IMAGES_DIR\"/*.vdi \"$IMAGES_DIR\"/*.vhdx \"$IMAGES_DIR\"/*.raw \"$IMAGES_DIR\"/*.img; do\n        [ -f \"$img\" ] || continue\n        \n        filename=$(basename \"$img\")\n        echo \"\"\n        echo \"File: $filename\"\n        \n        # Check actual format\n        actual_format=$(qemu-img info --output=json \"$img\" 2>/dev/null | python3 -c \"import sys, json; print(json.load(sys.stdin).get('format', 'unknown'))\" 2>/dev/null || echo \"unknown\")\n        file_type=$(file -b \"$img\" | cut -d',' -f1)\n        \n        echo \"  File type: $file_type\"\n        echo \"  QEMU format: $actual_format\"\n        \n        if [ \"$actual_format\" = \"qcow2\" ]; then\n            echo -e \"  Status: ${GREEN}‚úì QCOW2 (native)${NC}\"\n            \n            # Get size info\n            virtual_size=$(qemu-img info \"$img\" | grep \"virtual size\" | awk '{print $3, $4}')\n            disk_size=$(qemu-img info \"$img\" | grep \"disk size\" | awk '{print $3, $4}')\n            echo \"  Virtual size: $virtual_size\"\n            echo \"  Disk size: $disk_size\"\n        else\n            echo -e \"  Status: ${YELLOW}‚ö† Needs conversion (format: $actual_format)${NC}\"\n            echo \"  Convert with: qemu-img convert -f $actual_format -O qcow2 '$img' '${img%.*}_converted.qcow2'\"\n        fi\n    done\nfi\n\n# Check custom images\necho \"\"\nif [ -d \"$CUSTOM_DIR\" ]; then\n    echo \"=== Custom Images ===\"\n    custom_count=0\n    for img in \"$CUSTOM_DIR\"/*.*; do\n        [ -f \"$img\" ] || continue\n        ((custom_count++))\n        \n        filename=$(basename \"$img\")\n        echo \"\"\n        echo \"File: $filename\"\n        \n        actual_format=$(qemu-img info --output=json \"$img\" 2>/dev/null | python3 -c \"import sys, json; print(json.load(sys.stdin).get('format', 'unknown'))\" 2>/dev/null || echo \"unknown\")\n        \n        if [ \"$actual_format\" = \"qcow2\" ]; then\n            echo -e \"  Status: ${GREEN}‚úì QCOW2${NC}\"\n            \n            # Test overlay creation\n            test_overlay=\"/tmp/test_overlay_$$.qcow2\"\n            if qemu-img create -f qcow2 -b \"$(realpath \"$img\")\" -F qcow2 \"$test_overlay\" &>/dev/null; then\n                echo -e \"  Overlay test: ${GREEN}‚úì Pass${NC}\"\n                rm -f \"$test_overlay\"\n            else\n                echo -e \"  Overlay test: ${RED}‚úó Failed${NC}\"\n            fi\n        else\n            echo -e \"  Status: ${YELLOW}‚ö† Format: $actual_format${NC}\"\n        fi\n    done\n    \n    if [ $custom_count -eq 0 ]; then\n        echo \"  No custom images found\"\n    fi\nelse\n    echo \"Custom images directory not found: $CUSTOM_DIR\"\nfi\n\n# Test router image specifically\necho \"\"\necho \"=== Router Image Test ===\"\nrouter_img=\"$IMAGES_DIR/router.qcow2\"\nif [ -f \"$router_img\" ]; then\n    echo \"Testing: $router_img\"\n    \n    format=$(qemu-img info --output=json \"$router_img\" 2>/dev/null | python3 -c \"import sys, json; print(json.load(sys.stdin).get('format', 'unknown'))\" 2>/dev/null || echo \"unknown\")\n    if [ \"$format\" = \"qcow2\" ]; then\n        echo -e \"${GREEN}‚úì${NC} Format: QCOW2\"\n        \n        # Test overlay\n        test_overlay=\"/tmp/router_test_$$.qcow2\"\n        if qemu-img create -f qcow2 -b \"$(realpath \"$router_img\")\" -F qcow2 \"$test_overlay\" &>/dev/null; then\n            echo -e \"${GREEN}‚úì${NC} Overlay creation: Success\"\n            \n            # Quick boot test (3 second timeout)\n            echo -n \"  Boot test: \"\n            if timeout 3 qemu-system-x86_64 \\\n                -hda \"$test_overlay\" \\\n                -m 512 \\\n                -nographic \\\n                -serial none \\\n                -monitor none &>/dev/null; then\n                echo -e \"${GREEN}‚úì${NC} Boots (QEMU accepts image)\"\n            else\n                # Timeout is expected, we just want to verify QEMU starts\n                echo -e \"${GREEN}‚úì${NC} Boots (timeout expected)\"\n            fi\n            \n            rm -f \"$test_overlay\"\n        else\n            echo -e \"${RED}‚úó${NC} Overlay creation: Failed\"\n        fi\n    else\n        echo -e \"${RED}‚úó${NC} Format: $format (expected QCOW2)\"\n        echo \"  Run: qemu-img convert -f $format -O qcow2 '$router_img' '${router_img%.qcow2}_converted.qcow2'\"\n    fi\nelse\n    echo -e \"${YELLOW}‚ö†${NC} Router image not found: $router_img\"\nfi\n\necho \"\"\necho \"=========================================\"\necho \"Verification Complete\"\necho \"=========================================\"",
    "backend/modules/guacamoleClient.js": "const { Client } = require('pg');\n\n/**\n * GuacamoleClient - Manages Guacamole connections in PostgreSQL\n */\nclass GuacamoleClient {\n  constructor() {\n    this.dbConfig = {\n      host: process.env.DB_HOST || 'localhost',\n      port: parseInt(process.env.DB_PORT) || 5432,\n      database: process.env.DB_NAME || 'guacamole_db',\n      user: process.env.DB_USER || 'guacamole',\n      password: process.env.DB_PASSWORD || 'guacpass123',\n    };\n    \n    // URL for browser access (must be localhost:8081 since that's where the host exposes Guacamole)\n    this.guacBaseUrl = 'http://localhost:8081/guacamole';\n    this.connected = false;\n  }\n\n  async initialize() {\n    console.log('üîå Initializing GuacamoleClient...');\n    \n    // Retry connection up to 10 times with progressive delay\n    for (let attempt = 1; attempt <= 10; attempt++) {\n      try {\n        const client = new Client(this.dbConfig);\n        await client.connect();\n        \n        const result = await client.query('SELECT COUNT(*) FROM guacamole_connection');\n        console.log(`‚úÖ Connected to Guacamole database (${result.rows[0].count} existing connections)`);\n        \n        await client.end();\n        this.connected = true;\n        return;\n      } catch (error) {\n        if (attempt < 10) {\n          const delay = attempt * 1000;\n          console.log(`‚ö†Ô∏è  Database connection attempt ${attempt}/10 failed, retrying in ${delay}ms...`);\n          console.error(`   Connection details: ${this.dbConfig.host}:${this.dbConfig.port}/${this.dbConfig.database}`);\n          console.error(`   Error code: ${error.code}`);\n          console.error(`   Error message: ${error.message || error.toString()}`);\n          await new Promise(resolve => setTimeout(resolve, delay));\n        } else {\n          console.error('‚ö†Ô∏è  Failed to connect to Guacamole database after 10 attempts');\n          console.error(`   Host: ${this.dbConfig.host}:${this.dbConfig.port}`);\n          console.error(`   Database: ${this.dbConfig.database}`);\n          console.error(`   User: ${this.dbConfig.user}`);\n          console.error(`   Error: ${error.message || error.toString()}`);\n          console.error(`   Error code: ${error.code}`);\n          console.error('   Connections will not be registered in Guacamole');\n          this.connected = false;\n        }\n      }\n    }\n  }\n\n  isConnected() {\n    return this.connected;\n  }\n\n  /**\n   * Register a new VNC connection in Guacamole\n   */\n  async registerConnection(node, vncPort) {\n    if (!this.connected) {\n      console.warn('‚ö†Ô∏è  Database not connected, skipping Guacamole registration');\n      return {\n        id: null,\n        url: null,\n        pid: null\n      };\n    }\n\n    console.log(`üîó Registering Guacamole connection for node ${node.id}...`);\n    \n    const client = new Client(this.dbConfig);\n    \n    try {\n      await client.connect();\n\n      // Get the default entity (guacadmin user's entity)\n      const entityResult = await client.query(\n        'SELECT entity_id FROM guacamole_entity WHERE name = $1 AND type = $2',\n        ['guacadmin', 'USER']\n      );\n\n      if (entityResult.rows.length === 0) {\n        throw new Error('Default guacadmin entity not found');\n      }\n\n      const entityId = entityResult.rows[0].entity_id;\n\n      // Insert connection\n      const connectionName = node.name || `Node ${node.id.substring(0, 8)}`;\n      const insertConnectionResult = await client.query(\n        `INSERT INTO guacamole_connection (connection_name, protocol, parent_id)\n         VALUES ($1, $2, NULL)\n         RETURNING connection_id`,\n        [connectionName, 'vnc']\n      );\n\n      const connectionId = insertConnectionResult.rows[0].connection_id;\n      console.log(`  Created connection ID: ${connectionId}`);\n\n      // Insert VNC parameters\n      // VNC host: use the backend container name since QEMU runs in the backend container\n      // and guacd needs to connect to it via the Docker network\n      const vncHost = process.env.VNC_HOST || 'sandlabx-backend';\n      const parameters = [\n        { name: 'hostname', value: vncHost },\n        { name: 'port', value: String(vncPort) },\n        { name: 'password', value: '' }, // No VNC password\n        { name: 'color-depth', value: '16' },\n        { name: 'cursor', value: 'remote' },\n        { name: 'read-only', value: 'false' },\n        { name: 'enable-audio', value: 'false' },\n      ];\n\n      for (const param of parameters) {\n        await client.query(\n          `INSERT INTO guacamole_connection_parameter (connection_id, parameter_name, parameter_value)\n           VALUES ($1, $2, $3)`,\n          [connectionId, param.name, param.value]\n        );\n      }\n\n      console.log(`  Added VNC parameters: ${vncHost}:${vncPort}`);\n\n      // Grant permission to guacadmin\n      await client.query(\n        `INSERT INTO guacamole_connection_permission (entity_id, connection_id, permission)\n         VALUES ($1, $2, $3)`,\n        [entityId, connectionId, 'READ']\n      );\n\n      console.log(`  Granted READ permission to guacadmin`);\n\n      // Generate Guacamole URL\n      // Format: http://localhost:8081/guacamole/#/client/<base64-encoded-connection-info>\n      // For simplicity, we'll use the connection_id\n      const connectionToken = Buffer.from(\n        `${connectionId}\\0c\\0postgresql`\n      ).toString('base64');\n      \n      const guacUrl = `${this.guacBaseUrl}/#/client/${connectionToken}`;\n\n      await client.end();\n\n      console.log(`‚úÖ Guacamole connection registered: ${guacUrl}`);\n\n      return {\n        id: connectionId,\n        url: guacUrl,\n        pid: null // We don't track PID here, it's in qemuManager\n      };\n    } catch (error) {\n      await client.end();\n      console.error('Error registering Guacamole connection:', error);\n      throw new Error(`Failed to register Guacamole connection: ${error.message}`);\n    }\n  }\n\n  /**\n   * Unregister a connection from Guacamole\n   */\n  async unregisterConnection(connectionId) {\n    if (!this.connected || !connectionId) {\n      return;\n    }\n\n    console.log(`üîå Unregistering Guacamole connection ${connectionId}...`);\n    \n    const client = new Client(this.dbConfig);\n    \n    try {\n      await client.connect();\n\n      // Delete connection (cascades to parameters and permissions)\n      await client.query(\n        'DELETE FROM guacamole_connection WHERE connection_id = $1',\n        [connectionId]\n      );\n\n      await client.end();\n      \n      console.log(`‚úÖ Guacamole connection ${connectionId} unregistered`);\n    } catch (error) {\n      await client.end();\n      console.error('Error unregistering Guacamole connection:', error);\n      // Don't throw, this is not critical\n    }\n  }\n\n  /**\n   * List all Guacamole connections\n   */\n  async listConnections() {\n    if (!this.connected) {\n      return [];\n    }\n\n    const client = new Client(this.dbConfig);\n    \n    try {\n      await client.connect();\n\n      const result = await client.query(\n        `SELECT connection_id, connection_name, protocol, parent_id\n         FROM guacamole_connection\n         ORDER BY connection_id DESC`\n      );\n\n      await client.end();\n      \n      return result.rows;\n    } catch (error) {\n      await client.end();\n      console.error('Error listing Guacamole connections:', error);\n      return [];\n    }\n  }\n}\n\nmodule.exports = { GuacamoleClient };",
    "backend/modules/nodeManager.js": "const fs = require('fs').promises;\nconst path = require('path');\nconst { v4: uuidv4 } = require('uuid');\n\n/**\n * NodeManager - Manages node state and persistence\n */\nclass NodeManager {\n  constructor() {\n    this.stateFile = process.env.STATE_FILE || path.join(__dirname, '..', 'nodes-state.json');\n    this.nodes = new Map();\n    const overlaysEnv = process.env.OVERLAYS_PATH;\n    this.overlaysPath = overlaysEnv && overlaysEnv.length > 0\n      ? overlaysEnv\n      : path.join(__dirname, '..', '..', 'overlays');\n  }\n\n  async initialize() {\n    console.log('üìä Initializing NodeManager...');\n    \n    // Load existing state\n    try {\n      const data = await fs.readFile(this.stateFile, 'utf8');\n      const state = JSON.parse(data);\n      \n      // Restore nodes to Map\n      if (state.nodes && Array.isArray(state.nodes)) {\n        state.nodes.forEach(node => {\n          this.nodes.set(node.id, node);\n        });\n        console.log(`‚úÖ Loaded ${this.nodes.size} existing nodes from state file`);\n      }\n    } catch (error) {\n      if (error.code === 'ENOENT') {\n        console.log('üìù No existing state file, starting fresh');\n        await this.saveState();\n      } else {\n        console.error('‚ö†Ô∏è  Error loading state:', error.message);\n      }\n    }\n  }\n\n  async saveState() {\n    try {\n      const state = {\n        version: '1.0.0',\n        lastUpdated: new Date().toISOString(),\n        nodes: Array.from(this.nodes.values())\n      };\n      \n      await fs.writeFile(this.stateFile, JSON.stringify(state, null, 2), 'utf8');\n    } catch (error) {\n      console.error('Error saving state:', error);\n      throw error;\n    }\n  }\n\n  async createNode(name, osType = 'ubuntu', resources = {}, options = {}) {\n    const id = uuidv4();\n    const timestamp = new Date().toISOString();\n    const image = options.image || null;\n    const overlayPath = path.join(this.overlaysPath, `node_${id}.qcow2`);\n    \n    const node = {\n      id,\n      name: name || `node-${id.substring(0, 8)}`,\n      osType,\n      status: 'stopped',\n      overlayPath,\n      vncPort: null,\n      guacConnectionId: null,\n      guacUrl: null,\n      pid: null,\n      createdAt: timestamp,\n      updatedAt: timestamp,\n      startedAt: null,\n      stoppedAt: null,\n      wipedAt: null,\n      image,\n      resources: {\n        ram: parseInt(resources.ram) || parseInt(process.env.QEMU_RAM) || 2048,\n        cpus: parseInt(resources.cpus) || parseInt(process.env.QEMU_CPUS) || 2\n      }\n    };\n\n    this.nodes.set(id, node);\n    await this.saveState();\n    \n    console.log(`‚úÖ Created node: ${node.name} (${id}) - ${node.osType} with ${node.resources.ram}MB RAM, ${node.resources.cpus} CPUs`);\n    return node;\n  }\n\n  async getNode(id) {\n    return this.nodes.get(id) || null;\n  }\n\n  async listNodes() {\n    return Array.from(this.nodes.values()).sort((a, b) => \n      new Date(b.createdAt) - new Date(a.createdAt)\n    );\n  }\n\n  async updateNode(id, updates) {\n    const node = this.nodes.get(id);\n    if (!node) {\n      throw new Error('Node not found');\n    }\n\n    const updatedNode = {\n      ...node,\n      ...updates,\n      updatedAt: new Date().toISOString()\n    };\n\n    this.nodes.set(id, updatedNode);\n    await this.saveState();\n    \n    return updatedNode;\n  }\n\n  async deleteNode(id) {\n    const node = this.nodes.get(id);\n    if (!node) {\n      throw new Error('Node not found');\n    }\n\n    this.nodes.delete(id);\n    await this.saveState();\n    \n    console.log(`üóëÔ∏è  Deleted node: ${node.name} (${id})`);\n    return true;\n  }\n\n  async getNextAvailableVncPort() {\n    const startPort = parseInt(process.env.VNC_START_PORT) || 5900;\n    const usedPorts = new Set(\n      Array.from(this.nodes.values())\n        .filter(n => n.vncPort)\n        .map(n => n.vncPort)\n    );\n\n    let port = startPort;\n    while (usedPorts.has(port)) {\n      port++;\n    }\n\n    return port;\n  }\n}\n\nmodule.exports = { NodeManager };",
    "backend/modules/qemuManager.js": "const { spawn, exec } = require('child_process');\nconst { promisify } = require('util');\nconst fs = require('fs').promises;\nconst path = require('path');\nconst WebSocket = require('ws');\n\n// Added helper for readable file sizes\nfunction formatBytes(bytes) {\n  if (!Number.isFinite(bytes) || bytes <= 0) {\n    return '0 B';\n  }\n  const units = ['B', 'KB', 'MB', 'GB', 'TB'];\n  let value = bytes;\n  let unitIndex = 0;\n  while (value >= 1024 && unitIndex < units.length - 1) {\n    value /= 1024;\n    unitIndex += 1;\n  }\n  const precision = value >= 10 || unitIndex === 0 ? 0 : 1;\n  return `${value.toFixed(precision)} ${units[unitIndex]}`;\n}\n\nconst execAsync = promisify(exec);\n\n/**\n * QemuManager - Manages QEMU VM processes and disk overlays\n */\nclass QemuManager {\n  constructor() {\n    // Use absolute paths to avoid path resolution issues\n    const projectRoot = path.resolve(__dirname, '../../');\n    this.imagesPath = path.join(projectRoot, 'images');\n    this.customImagesPath = process.env.CUSTOM_IMAGES_PATH || path.join(this.imagesPath, 'custom');\n    \n    // Map OS types to their cloud base images\n    this.baseImages = {\n      'ubuntu': path.join(this.imagesPath, 'ubuntu-24-lts.qcow2'),      // Ubuntu 24 LTS Cloud Image\n      'alpine': path.join(this.imagesPath, 'alpine-3.qcow2'),           // Alpine Linux 3.x Cloud Image\n      'debian': path.join(this.imagesPath, 'debian-13.qcow2'),          // Debian 13 Cloud Image\n      'bazzite': path.join(this.imagesPath, 'bazzite-gnome.qcow2'),     // Bazzite GNOME\n      'default': path.join(this.imagesPath, 'ubuntu-24-lts.qcow2')      // Default to Ubuntu\n    };\n\n    // Added base metadata so frontend can show richer cards\n    this.baseImageMetadata = {\n      ubuntu: {\n        id: 'ubuntu-24-lts',\n        name: 'Ubuntu 24.04 LTS',\n        description: 'Ubuntu Noble Server Cloud Image',\n      },\n      alpine: {\n        id: 'alpine-3',\n        name: 'Alpine Linux 3.x',\n        description: 'Minimal Alpine cloud image',\n      },\n      debian: {\n        id: 'debian-13',\n        name: 'Debian 13 (Trixie)',\n        description: 'Debian NoCloud image',\n      },\n      bazzite: {\n        id: 'bazzite-gnome',\n        name: 'Bazzite GNOME',\n        description: 'Fedora based gaming distro',\n      }\n    };\n    \n    this.baseImagePath = process.env.BASE_IMAGE_PATH || this.baseImages.default;\n    this.overlaysPath = process.env.OVERLAYS_PATH || path.join(projectRoot, 'overlays');\n    this.vmsPath = process.env.VMS_PATH || path.join(projectRoot, 'vms');\n    this.runningVMs = new Map(); // id -> process\n  }\n\n  /**\n   * Get the base image path for a specific OS type\n   */\n  getBaseImageForOS(osType) {\n    return this.baseImages[osType] || this.baseImages.default;\n  }\n\n  async initialize() {\n    console.log('üñ•Ô∏è  Initializing QemuManager...');\n    \n    // Create directories if they don't exist\n    try {\n      await fs.mkdir(this.overlaysPath, { recursive: true });\n      console.log(`‚úÖ Overlays directory: ${this.overlaysPath}`);\n    } catch (error) {\n      console.error('Error creating overlays directory:', error.message);\n    }\n\n    // Added to ensure custom images directory exists\n    try {\n      await fs.mkdir(this.customImagesPath, { recursive: true });\n      console.log(`‚úÖ Custom images directory: ${this.customImagesPath}`);\n    } catch (error) {\n      console.error('Error creating custom images directory:', error.message);\n    }\n\n    // Check if base image exists\n    try {\n      await fs.access(this.baseImagePath);\n      console.log(`‚úÖ Base image found: ${this.baseImagePath}`);\n    } catch (error) {\n      console.warn(`‚ö†Ô∏è  Base image not found: ${this.baseImagePath}`);\n      console.warn('   You will need to create a base image to run VMs');\n    }\n\n    // Check for qemu-img and qemu-system-x86_64\n    try {\n      await execAsync('which qemu-img');\n      await execAsync('which qemu-system-x86_64');\n      console.log('‚úÖ QEMU tools found');\n    } catch (error) {\n      console.warn('‚ö†Ô∏è  QEMU tools not found in PATH');\n      console.warn('   Install: apt-get install qemu-system-x86 qemu-utils');\n    }\n  }\n\n  /**\n   * Create QCOW2 overlay from base image\n   */\n  async createOverlay(node) {\n    console.log(`üìÄ Creating overlay for node ${node.id}...`);\n    \n    const overlayPath = node.overlayPath;\n    const baseImage = node.image && node.image.path ? node.image.path : this.getBaseImageForOS(node.osType);\n    \n    try {\n      // Check if overlay already exists\n      try {\n        await fs.access(overlayPath);\n        console.log(`  Overlay already exists: ${overlayPath}`);\n        return overlayPath;\n      } catch (error) {\n        // Overlay doesn't exist, create it\n      }\n\n      // Verify base image exists\n      try {\n        await fs.access(baseImage);\n        console.log(`  Using base image: ${baseImage}`);\n      } catch (error) {\n        throw new Error(`Base image not found: ${baseImage}`);\n      }\n\n      // Create overlay using qemu-img\n      const cmd = `qemu-img create -f qcow2 -b ${baseImage} -F qcow2 ${overlayPath}`;\n      console.log(`  Running: ${cmd}`);\n      \n      const { stdout, stderr } = await execAsync(cmd);\n      if (stderr && !stderr.includes('Formatting')) {\n        console.warn('  qemu-img stderr:', stderr);\n      }\n      \n      console.log(`‚úÖ Overlay created: ${overlayPath}`);\n      return overlayPath;\n    } catch (error) {\n      console.error('Error creating overlay:', error);\n      throw new Error(`Failed to create overlay: ${error.message}`);\n    }\n  }\n\n  /**\n   * Start QEMU VM with the overlay\n   */\n  async startVM(node) {\n    console.log(`üöÄ Starting VM for node ${node.id}...`);\n    \n    // Create overlay if it doesn't exist\n    await this.createOverlay(node);\n    \n    // Get VNC port (use node's port if assigned, or get next available)\n    const vncPort = node.vncPort || await this.getNextAvailablePort();\n    const vncDisplay = vncPort - 5900; // VNC display number\n    \n    // Build QEMU command with better boot options\n    const qemuArgs = [\n      '-vnc', `0.0.0.0:${vncDisplay}`,\n      '-hda', node.overlayPath,\n      '-m', String(node.resources.ram || 2048),\n      '-smp', String(node.resources.cpus || 2),\n      '-boot', 'c',  // Boot from hard disk\n      '-name', `node_${node.id}`,\n      '-vga', 'std',  // Standard VGA for better compatibility\n      '-serial', 'stdio',  // Serial console for debugging\n    ];\n\n    // Add KVM acceleration if available (Linux only)\n    if (process.platform === 'linux') {\n      try {\n        await fs.access('/dev/kvm');\n        qemuArgs.push('-enable-kvm');\n        console.log('  KVM acceleration enabled');\n      } catch (error) {\n        console.log('  KVM not available, using software emulation');\n      }\n    }\n\n    console.log(`  VNC Port: ${vncPort} (display :${vncDisplay})`);\n    console.log(`  Command: qemu-system-x86_64 ${qemuArgs.join(' ')}`);\n    console.log(`  Overlay: ${node.overlayPath}`);\n    console.log(`  Base: ${this.baseImagePath}`);\n    try {\n      // Spawn QEMU process\n      const qemuProcess = spawn('qemu-system-x86_64', qemuArgs, {\n        detached: false,\n        stdio: ['pipe', 'pipe', 'pipe']\n      });\n\n      // Store process reference\n      this.runningVMs.set(node.id, {\n        process: qemuProcess,\n        vncPort: vncPort,\n        startTime: Date.now(),\n        consoleClients: new Set()\n      });\n\n      // Handle process events\n      qemuProcess.stdout.on('data', (data) => {\n        console.log(`  [QEMU ${node.id}] ${data.toString().trim()}`);\n      });\n\n      qemuProcess.stderr.on('data', (data) => {\n        const msg = data.toString().trim();\n        if (!msg.includes('warning') && !msg.includes('info')) {\n          console.error(`  [QEMU ${node.id} ERROR] ${msg}`);\n        }\n      });\n\n      qemuProcess.on('exit', (code, signal) => {\n        console.log(`  [QEMU ${node.id}] Process exited (code: ${code}, signal: ${signal})`);\n        const vmInfo = this.runningVMs.get(node.id);\n        if (vmInfo && vmInfo.consoleClients) {\n          for (const client of vmInfo.consoleClients) {\n            try {\n              if (client.socket.readyState === WebSocket.OPEN) {\n                client.socket.send(JSON.stringify({ type: 'exit', code, signal }));\n                client.socket.close(1000, 'VM terminated');\n              }\n            } catch (err) {\n              console.error('  [QEMU console] notify error:', err.message);\n            }\n          }\n          vmInfo.consoleClients.clear();\n        }\n        this.runningVMs.delete(node.id);\n      });\n\n      qemuProcess.on('error', (error) => {\n        console.error(`  [QEMU ${node.id}] Process error:`, error);\n        this.runningVMs.delete(node.id);\n      });\n\n      // Wait a moment to ensure VM started\n      await new Promise(resolve => setTimeout(resolve, 1000));\n\n      if (qemuProcess.exitCode !== null) {\n        throw new Error(`QEMU process exited immediately with code ${qemuProcess.exitCode}`);\n      }\n\n      console.log(`‚úÖ VM started: PID ${qemuProcess.pid}, VNC :${vncDisplay} (${vncPort})`);\n      \n      return vncPort;\n    } catch (error) {\n      this.runningVMs.delete(node.id);\n      console.error('Error starting VM:', error);\n      throw new Error(`Failed to start VM: ${error.message}`);\n    }\n  }\n\n  /**\n   * Stop QEMU VM\n   */\n  async stopVM(node) {\n    console.log(`‚èπÔ∏è  Stopping VM for node ${node.id}...`);\n    \n    const vmInfo = this.runningVMs.get(node.id);\n    if (!vmInfo) {\n      console.log('  VM is not running');\n      return;\n    }\n\n    try {\n      const { process: qemuProcess } = vmInfo;\n      \n      // Try graceful shutdown first (SIGTERM)\n      qemuProcess.kill('SIGTERM');\n      \n      // Wait up to 5 seconds for graceful shutdown\n      await new Promise((resolve) => {\n        const timeout = setTimeout(() => {\n          if (this.runningVMs.has(node.id)) {\n            console.log('  Graceful shutdown timeout, forcing kill...');\n            qemuProcess.kill('SIGKILL');\n          }\n          resolve();\n        }, 5000);\n\n        qemuProcess.once('exit', () => {\n          clearTimeout(timeout);\n          resolve();\n        });\n      });\n\n      this.runningVMs.delete(node.id);\n      if (vmInfo.consoleClients) {\n        for (const client of vmInfo.consoleClients) {\n          try {\n            if (client.socket.readyState === WebSocket.OPEN) {\n              client.socket.send(JSON.stringify({ type: 'exit', code: null, signal: 'terminated' }));\n              client.socket.close(1000, 'VM stopped');\n            }\n          } catch (err) {\n            console.error('  [QEMU console] stop notify error:', err.message);\n          }\n        }\n        vmInfo.consoleClients.clear();\n      }\n      console.log(`‚úÖ VM stopped for node ${node.id}`);\n    } catch (error) {\n      console.error('Error stopping VM:', error);\n      throw new Error(`Failed to stop VM: ${error.message}`);\n    }\n  }\n\n  /**\n   * Wipe overlay (delete and recreate)\n   */\n  async wipeOverlay(node) {\n    console.log(`üßπ Wiping overlay for node ${node.id}...`);\n    \n    try {\n      // Delete existing overlay\n      try {\n        await fs.unlink(node.overlayPath);\n        console.log(`  Deleted: ${node.overlayPath}`);\n      } catch (error) {\n        if (error.code !== 'ENOENT') {\n          console.warn(`  Warning: ${error.message}`);\n        }\n      }\n\n      // Recreate overlay\n      await this.createOverlay(node);\n      \n      console.log(`‚úÖ Overlay wiped for node ${node.id}`);\n    } catch (error) {\n      console.error('Error wiping overlay:', error);\n      throw new Error(`Failed to wipe overlay: ${error.message}`);\n    }\n  }\n\n  /**\n   * Delete overlay completely\n   */\n  async deleteOverlay(node) {\n    console.log(`üóëÔ∏è  Deleting overlay for node ${node.id}...`);\n    \n    try {\n      await fs.unlink(node.overlayPath);\n      console.log(`‚úÖ Overlay deleted: ${node.overlayPath}`);\n    } catch (error) {\n      if (error.code !== 'ENOENT') {\n        console.error('Error deleting overlay:', error);\n        throw error;\n      }\n    }\n  }\n\n  /**\n   * Get next available VNC port by checking actual system ports\n   */\n  async getNextAvailablePort() {\n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    const startPort = parseInt(process.env.VNC_START_PORT) || 5900;\n    const maxPort = startPort + 100; // Check up to 100 ports\n    \n    // Get ports currently used by our running VMs\n    const usedByUs = new Set(\n      Array.from(this.runningVMs.values()).map(vm => vm.vncPort)\n    );\n\n    // Check actual system ports\n    for (let port = startPort; port < maxPort; port++) {\n      if (usedByUs.has(port)) {\n        continue; // Skip ports we know we're using\n      }\n      \n      // Check if port is available on the system\n      try {\n        const { stdout } = await execAsync(`netstat -tln 2>/dev/null | grep :${port} || ss -tln | grep :${port}`);\n        if (stdout.trim()) {\n          // Port is in use\n          continue;\n        }\n      } catch (error) {\n        // Command failed (no match found), port is available\n      }\n      \n      // Port is available!\n      return port;\n    }\n\n    // If we get here, all ports are in use\n    throw new Error(`No available VNC ports in range ${startPort}-${maxPort}`);\n  }\n\n  /**\n   * Cleanup all running VMs\n   */\n  async cleanup() {\n    console.log('üßπ Cleaning up QEMU processes...');\n    \n    const promises = Array.from(this.runningVMs.keys()).map(async (nodeId) => {\n      const vmInfo = this.runningVMs.get(nodeId);\n      if (vmInfo && vmInfo.process) {\n        try {\n          vmInfo.process.kill('SIGTERM');\n          console.log(`  Stopped VM: ${nodeId}`);\n        } catch (error) {\n          console.error(`  Error stopping VM ${nodeId}:`, error.message);\n        }\n      }\n    });\n\n    await Promise.all(promises);\n    this.runningVMs.clear();\n    console.log('‚úÖ Cleanup complete');\n  }\n\n  // Added to enumerate built-in and custom images for the UI\n  async listAvailableImages() {\n    const baseEntries = await Promise.all(Object.entries(this.baseImages)\n      .filter(([key]) => key !== 'default')\n      .map(async ([key, imagePath]) => {\n        try {\n          const stats = await fs.stat(imagePath);\n          const meta = this.baseImageMetadata[key] || { id: key, name: key, description: '' };\n          return {\n            type: 'base',\n            id: key,\n            name: meta.name,\n            description: meta.description,\n            path: imagePath,\n            sizeBytes: stats.size,\n            size: formatBytes(stats.size),\n            available: true\n          };\n        } catch (error) {\n          const meta = this.baseImageMetadata[key] || { id: key, name: key, description: '' };\n          return {\n            type: 'base',\n            id: key,\n            name: meta.name,\n            description: meta.description,\n            path: imagePath,\n            sizeBytes: 0,\n            size: '0 B',\n            available: false,\n            error: error.message\n          };\n        }\n      }));\n\n    let customEntries = [];\n    try {\n      const files = await fs.readdir(this.customImagesPath);\n      customEntries = await Promise.all(files.filter(f => f.endsWith('.qcow2')).map(async (file) => {\n        const fullPath = path.join(this.customImagesPath, file);\n        const stats = await fs.stat(fullPath);\n        return {\n          type: 'custom',\n          id: file,\n          name: file.replace(/\\.qcow2$/i, ''),\n          path: fullPath,\n          sizeBytes: stats.size,\n          size: formatBytes(stats.size),\n          available: true,\n          uploadedAt: stats.birthtime\n        };\n      }));\n    } catch (error) {\n      console.error('Error listing custom images:', error.message);\n    }\n\n    return {\n      baseImages: baseEntries,\n      customImages: customEntries\n    };\n  }\n\n  // Added helper to resolve the source image for a node request\n  async resolveImage({ imageType = 'base', osType = 'ubuntu', customImageName }) {\n    if (imageType === 'custom') {\n      if (!customImageName) {\n        throw new Error('Custom image name required');\n      }\n      const candidate = path.join(this.customImagesPath, customImageName);\n      try {\n        const stats = await fs.stat(candidate);\n        return {\n          type: 'custom',\n          id: customImageName,\n          path: candidate,\n          sizeBytes: stats.size,\n          size: formatBytes(stats.size),\n          name: path.parse(customImageName).name\n        };\n      } catch (error) {\n        throw new Error(`Custom image not found: ${customImageName}`);\n      }\n    }\n\n    const basePath = this.getBaseImageForOS(osType);\n    try {\n      const stats = await fs.stat(basePath);\n      const meta = this.baseImageMetadata[osType] || { name: osType, description: '' };\n      return {\n        type: 'base',\n        id: osType,\n        path: basePath,\n        sizeBytes: stats.size,\n        size: formatBytes(stats.size),\n        name: meta.name,\n        description: meta.description\n      };\n    } catch (error) {\n      throw new Error(`Base image not available for ${osType}`);\n    }\n  }\n\n  // Added to connect WebSocket clients to QEMU stdio\n  attachConsoleClient(nodeId, socket) {\n    const vmInfo = this.runningVMs.get(nodeId);\n    if (!vmInfo || !vmInfo.process) {\n      throw new Error('VM is not running');\n    }\n\n    const { process } = vmInfo;\n    if (!process.stdin || !process.stdout) {\n      throw new Error('Console streams unavailable');\n    }\n\n    const stdoutHandler = (data) => {\n      try {\n        if (socket.readyState === WebSocket.OPEN) {\n          socket.send(JSON.stringify({ type: 'data', stream: 'stdout', payload: data.toString('utf8') }));\n        }\n      } catch (error) {\n        console.error('Console stdout handler error:', error.message);\n      }\n    };\n\n    const stderrHandler = (data) => {\n      try {\n        if (socket.readyState === WebSocket.OPEN) {\n          socket.send(JSON.stringify({ type: 'data', stream: 'stderr', payload: data.toString('utf8') }));\n        }\n      } catch (error) {\n        console.error('Console stderr handler error:', error.message);\n      }\n    };\n\n    process.stdout.on('data', stdoutHandler);\n    process.stderr.on('data', stderrHandler);\n\n    socket.on('message', (message) => {\n      try {\n        const payload = Buffer.isBuffer(message) ? message.toString('utf8') : String(message);\n        process.stdin.write(payload);\n      } catch (error) {\n        console.error('Console stdin write error:', error.message);\n      }\n    });\n\n    socket.on('close', () => {\n      process.stdout.off('data', stdoutHandler);\n      process.stderr.off('data', stderrHandler);\n      vmInfo.consoleClients.delete(clientRef);\n    });\n\n    const clientRef = { socket, stdoutHandler, stderrHandler };\n    vmInfo.consoleClients.add(clientRef);\n\n    socket.send(JSON.stringify({ type: 'ready', nodeId }));\n  }\n\n  /**\n   * Ensure image is in QCOW2 format, convert if necessary\n   */\n  async ensureQcow2Format(imagePath) {\n    console.log(`üîç Checking format of ${path.basename(imagePath)}...`);\n    \n    try {\n      // Detect the current format\n      const { stdout } = await execAsync(`qemu-img info --output=json \"${imagePath}\"`);\n      const info = JSON.parse(stdout);\n      const currentFormat = info.format;\n      \n      console.log(`  Current format: ${currentFormat}`);\n      \n      // If already QCOW2, return as-is\n      if (currentFormat === 'qcow2') {\n        console.log(`‚úÖ Image is already in QCOW2 format`);\n        return imagePath;\n      }\n      \n      // Need to convert\n      const ext = path.extname(imagePath);\n      const baseName = path.basename(imagePath, ext);\n      const convertedPath = path.join(\n        path.dirname(imagePath),\n        `${baseName}_converted.qcow2`\n      );\n      \n      console.log(`üîÑ Converting ${currentFormat} to QCOW2...`);\n      console.log(`  Source: ${imagePath}`);\n      console.log(`  Target: ${convertedPath}`);\n      \n      // Convert to QCOW2\n      const cmd = `qemu-img convert -f ${currentFormat} -O qcow2 \"${imagePath}\" \"${convertedPath}\"`;\n      await execAsync(cmd);\n      \n      // Verify conversion\n      const { stdout: verifyOutput } = await execAsync(`qemu-img info --output=json \"${convertedPath}\"`);\n      const verifyInfo = JSON.parse(verifyOutput);\n      \n      if (verifyInfo.format !== 'qcow2') {\n        throw new Error(`Conversion failed: resulting format is ${verifyInfo.format}`);\n      }\n      \n      console.log(`‚úÖ Conversion successful`);\n      console.log(`  Original size: ${formatBytes(info['actual-size'] || info['virtual-size'])}`);\n      console.log(`  Converted size: ${formatBytes(verifyInfo['actual-size'] || verifyInfo['virtual-size'])}`);\n      \n      return convertedPath;\n    } catch (error) {\n      console.error('Error converting image format:', error);\n      throw new Error(`Failed to convert image to QCOW2: ${error.message}`);\n    }\n  }\n}\n\nmodule.exports = { QemuManager };",
    "backend/.env.example": "# Backend Server Configuration\nPORT=3001\nNODE_ENV=development\n\n# PostgreSQL Configuration (Guacamole Database)\nDB_HOST=localhost\nDB_PORT=5432\nDB_NAME=guacamole_db\nDB_USER=guacamole\nDB_PASSWORD=guacpass123\n\n# Guacamole Configuration\nGUAC_BASE_URL=http://localhost:8081/guacamole\nGUAC_ADMIN_USER=guacadmin\nGUAC_ADMIN_PASS=guacadmin\n\n# QEMU Configuration\nBASE_IMAGE_PATH=/home/naki/Desktop/itsthatnewshit/sandboxlabs/images/base.qcow2\nOVERLAYS_PATH=/home/naki/Desktop/itsthatnewshit/sandboxlabs/overlays\nVMS_PATH=/home/naki/Desktop/itsthatnewshit/sandboxlabs/vms\nVNC_START_PORT=5900\nQEMU_RAM=2048\nQEMU_CPUS=2\n\n# State Management\nSTATE_FILE=/home/naki/Desktop/itsthatnewshit/sandboxlabs/backend/nodes-state.json",
    "backend/.gitignore": "# .gitignore for backend\n\n# Dependencies\nnode_modules/\npackage-lock.json\n\n# Environment\n.env.local\n.env.production\n\n# State files\nnodes-state.json\n\n# Logs\n*.log\nnpm-debug.log*\n\n# OS files\n.DS_Store\nThumbs.db\n\n# Editor files\n.vscode/\n.idea/\n*.swp\n*.swo\n*~\n\n# Temporary files\ntmp/\ntemp/",
    "backend/Dockerfile": "FROM node:18-bullseye-slim\n\nWORKDIR /app\n\n# Install QEMU and required tools (Debian apt packages are more reliable here)\nRUN apt-get update \\\n  && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \\\n    qemu-system-x86 \\\n    qemu-utils \\\n    curl \\\n    wget \\\n    ca-certificates \\\n    bash \\\n  && rm -rf /var/lib/apt/lists/*\n\n# Copy package files\nCOPY package*.json ./\n\n# Install dependencies\nRUN npm ci --only=production\n\n# Copy application code\nCOPY . .\n\n# Copy initialization script\nCOPY init-images.sh /usr/local/bin/init-images.sh\nRUN chmod +x /usr/local/bin/init-images.sh\n\n# Create directories\nRUN mkdir -p /overlays /images\n\n# Expose port\nEXPOSE 3001\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \\\n  CMD node -e \"require('http').get('http://localhost:3001/api/health', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})\"\n\n# Start with image initialization then server\nCMD [\"/bin/bash\", \"-c\", \"/usr/local/bin/init-images.sh && node server.js\"]",
    "backend/package.json": "{\n  \"name\": \"sandboxlabs-backend\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Backend API for SandBoxLabs network lab management\",\n  \"main\": \"server.js\",\n  \"scripts\": {\n    \"start\": \"node server.js\",\n    \"dev\": \"nodemon server.js\",\n    \"test\": \"echo \\\"No tests yet\\\" && exit 0\"\n  },\n  \"keywords\": [\"qemu\", \"guacamole\", \"vm\", \"network-lab\"],\n  \"author\": \"SandBoxLabs\",\n  \"license\": \"MIT\",\n  \"dependencies\": {\n    \"express\": \"^4.18.2\",\n    \"pg\": \"^8.11.0\",\n    \"uuid\": \"^9.0.0\",\n    \"dotenv\": \"^16.0.3\",\n    \"cors\": \"^2.8.5\",\n  \"multer\": \"^2.0.0\",\n    \"ws\": \"^8.18.0\"\n  },\n  \"devDependencies\": {\n    \"nodemon\": \"^3.0.1\"\n  }\n}",
    "backend/server.js": "const express = require('express');\nconst cors = require('cors');\nconst dotenv = require('dotenv');\nconst path = require('path');\nconst fs = require('fs').promises;\nconst http = require('http');\nconst multer = require('multer');\nconst { WebSocketServer } = require('ws');\n\n// Load environment variables\ndotenv.config();\n\n// Import modules\nconst { NodeManager } = require('./modules/nodeManager');\nconst { GuacamoleClient } = require('./modules/guacamoleClient');\nconst { QemuManager } = require('./modules/qemuManager');\n\n// Initialize Express app\nconst app = express();\nconst PORT = process.env.PORT || 3001;\n\n// Middleware\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\n// Request logging middleware\napp.use((req, res, next) => {\n  console.log(`[${new Date().toISOString()}] ${req.method} ${req.url}`);\n  next();\n});\n\n// Initialize managers\nconst nodeManager = new NodeManager();\nconst guacamoleClient = new GuacamoleClient();\nconst qemuManager = new QemuManager();\n\n// Added upload middleware for custom disk images\nconst upload = multer({\n  storage: multer.diskStorage({\n    destination: (_, __, cb) => cb(null, qemuManager.customImagesPath),\n    filename: (_, file, cb) => {\n      const baseName = path.parse(file.originalname).name.replace(/[^a-zA-Z0-9-_]+/g, '_');\n      const filename = `${baseName || 'custom'}_${Date.now()}${path.extname(file.originalname)}`;\n      cb(null, filename);\n    }\n  }),\n  fileFilter: (_, file, cb) => {\n    const ext = file.originalname.toLowerCase();\n    const supportedFormats = ['.qcow2', '.vmdk', '.vdi', '.vhdx', '.raw', '.img', '.iso'];\n    if (!supportedFormats.some(fmt => ext.endsWith(fmt))) {\n      return cb(new Error(`Unsupported format. Supported: ${supportedFormats.join(', ')}`));\n    }\n    cb(null, true);\n  },\n  limits: {\n    fileSize: 20 * 1024 * 1024 * 1024 // 20 GB\n  }\n});\n\nlet httpServer;\nlet wsServer;\n\n// Health check endpoint\napp.get('/api/health', (req, res) => {\n  res.json({\n    status: 'healthy',\n    timestamp: new Date().toISOString(),\n    version: '1.0.0',\n    services: {\n      backend: 'running',\n      guacamole: guacamoleClient.isConnected() ? 'connected' : 'disconnected',\n    }\n  });\n});\n\n// =======================\n// NODE ENDPOINTS\n// =======================\n\n/**\n * GET /api/nodes\n * List all nodes with their current status\n */\napp.get('/api/nodes', async (req, res) => {\n  try {\n    const nodes = await nodeManager.listNodes();\n    res.json({\n      success: true,\n      nodes: nodes,\n      count: nodes.length\n    });\n  } catch (error) {\n    console.error('Error listing nodes:', error);\n    res.status(500).json({\n      success: false,\n      error: error.message || 'Failed to list nodes'\n    });\n  }\n});\n\n/**\n * GET /api/nodes/:id\n * Get details of a specific node\n */\napp.get('/api/nodes/:id', async (req, res) => {\n  try {\n    const { id } = req.params;\n    const node = await nodeManager.getNode(id);\n    \n    if (!node) {\n      return res.status(404).json({\n        success: false,\n        error: 'Node not found'\n      });\n    }\n    \n    res.json({\n      success: true,\n      ...node\n    });\n  } catch (error) {\n    console.error('Error getting node:', error);\n    res.status(500).json({\n      success: false,\n      error: error.message || 'Failed to get node'\n    });\n  }\n});\n\n/**\n * POST /api/nodes\n * Create a new node (creates QCOW2 overlay)\n */\napp.post('/api/nodes', async (req, res) => {\n  try {\n    const { name, osType, resources, imageType, customImageName } = req.body;\n    const resolvedOsType = osType || 'ubuntu';\n\n    let image = null;\n    try {\n      image = await qemuManager.resolveImage({\n        imageType: imageType || 'base',\n        osType: resolvedOsType,\n        customImageName\n      });\n    } catch (imageError) {\n      return res.status(400).json({\n        success: false,\n        error: imageError.message || 'Invalid image selection'\n      });\n    }\n    \n    console.log(`Creating new node: ${name || 'auto-generated'} (${osType || 'ubuntu'})`);\n    \n    // Create node with overlay\n    const node = await nodeManager.createNode(name, resolvedOsType, resources, { image });\n    \n    res.status(201).json({\n      success: true,\n      ...node\n    });\n  } catch (error) {\n    console.error('Error creating node:', error);\n    res.status(500).json({\n      success: false,\n      error: error.message || 'Failed to create node'\n    });\n  }\n});\n\n/**\n * POST /api/nodes/:id/run\n * Start a node (boot QEMU VM with overlay)\n */\napp.post('/api/nodes/:id/run', async (req, res) => {\n  try {\n    const { id } = req.params;\n    \n    console.log(`Starting node: ${id}`);\n    \n    // Get node info\n    const node = await nodeManager.getNode(id);\n    if (!node) {\n      return res.status(404).json({\n        success: false,\n        error: 'Node not found'\n      });\n    }\n    \n    if (node.status === 'running') {\n      return res.status(400).json({\n        success: false,\n        error: 'Node is already running'\n      });\n    }\n    \n    // Start QEMU VM\n    const vncPort = await qemuManager.startVM(node);\n    \n    // Register with Guacamole\n    const guacConnection = await guacamoleClient.registerConnection(node, vncPort);\n    \n    // Update node state\n    const updatedNode = await nodeManager.updateNode(id, {\n      status: 'running',\n      vncPort: vncPort,\n      guacConnectionId: guacConnection.id,\n      guacUrl: guacConnection.url,\n      pid: guacConnection.pid,\n      startedAt: new Date().toISOString()\n    });\n    \n    res.json({\n      success: true,\n      ...updatedNode\n    });\n  } catch (error) {\n    console.error('Error starting node:', error);\n    res.status(500).json({\n      success: false,\n      error: error.message || 'Failed to start node'\n    });\n  }\n});\n\n/**\n * POST /api/nodes/:id/stop\n * Stop a node (shutdown QEMU VM)\n */\napp.post('/api/nodes/:id/stop', async (req, res) => {\n  try {\n    const { id } = req.params;\n    \n    console.log(`Stopping node: ${id}`);\n    \n    const node = await nodeManager.getNode(id);\n    if (!node) {\n      return res.status(404).json({\n        success: false,\n        error: 'Node not found'\n      });\n    }\n    \n    if (node.status !== 'running') {\n      return res.status(400).json({\n        success: false,\n        error: 'Node is not running'\n      });\n    }\n    \n    // Stop QEMU VM\n    await qemuManager.stopVM(node);\n    \n    // Unregister from Guacamole (optional, can keep for history)\n    // await guacamoleClient.unregisterConnection(node.guacConnectionId);\n    \n    // Update node state\n    const updatedNode = await nodeManager.updateNode(id, {\n      status: 'stopped',\n      vncPort: null,\n      guacConnectionId: null,\n      guacUrl: null,\n      pid: null,\n      stoppedAt: new Date().toISOString()\n    });\n    \n    res.json({\n      success: true,\n      ...updatedNode\n    });\n  } catch (error) {\n    console.error('Error stopping node:', error);\n    res.status(500).json({\n      success: false,\n      error: error.message || 'Failed to stop node'\n    });\n  }\n});\n\n/**\n * POST /api/nodes/:id/wipe\n * Wipe a node (delete overlay and recreate from base)\n */\napp.post('/api/nodes/:id/wipe', async (req, res) => {\n  try {\n    const { id } = req.params;\n    \n    console.log(`Wiping node: ${id}`);\n    \n    const node = await nodeManager.getNode(id);\n    if (!node) {\n      return res.status(404).json({\n        success: false,\n        error: 'Node not found'\n      });\n    }\n    \n    // Stop VM if running\n    if (node.status === 'running') {\n      await qemuManager.stopVM(node);\n    }\n    \n    // Delete and recreate overlay\n    await qemuManager.wipeOverlay(node);\n    \n    // Update node state\n    const updatedNode = await nodeManager.updateNode(id, {\n      status: 'stopped',\n      vncPort: null,\n      guacConnectionId: null,\n      guacUrl: null,\n      pid: null,\n      wipedAt: new Date().toISOString()\n    });\n    \n    res.json({\n      success: true,\n      message: 'Node wiped successfully',\n      ...updatedNode\n    });\n  } catch (error) {\n    console.error('Error wiping node:', error);\n    res.status(500).json({\n      success: false,\n      error: error.message || 'Failed to wipe node'\n    });\n  }\n});\n\n/**\n * DELETE /api/nodes/:id\n * Delete a node completely (stop VM, delete overlay, remove from state)\n */\napp.delete('/api/nodes/:id', async (req, res) => {\n  try {\n    const { id } = req.params;\n    \n    console.log(`Deleting node: ${id}`);\n    \n    const node = await nodeManager.getNode(id);\n    if (!node) {\n      return res.status(404).json({\n        success: false,\n        error: 'Node not found'\n      });\n    }\n    \n    // Stop VM if running\n    if (node.status === 'running') {\n      await qemuManager.stopVM(node);\n    }\n    \n    // Delete overlay file\n    await qemuManager.deleteOverlay(node);\n    \n    // Remove from state\n    await nodeManager.deleteNode(id);\n    \n    res.json({\n      success: true,\n      message: 'Node deleted successfully',\n      id: id\n    });\n  } catch (error) {\n    console.error('Error deleting node:', error);\n    res.status(500).json({\n      success: false,\n      error: error.message || 'Failed to delete node'\n    });\n  }\n});\n\n// Added image catalogue endpoint for frontend selection UI\napp.get('/api/images', async (req, res) => {\n  try {\n    const images = await qemuManager.listAvailableImages();\n    res.json({\n      success: true,\n      ...images\n    });\n  } catch (error) {\n    console.error('Error listing images:', error);\n    res.status(500).json({ success: false, error: 'Failed to list images' });\n  }\n});\n\n// Added upload endpoint for custom QCOW2 images\napp.post('/api/images/custom', upload.single('image'), async (req, res) => {\n  try {\n    if (!req.file) {\n      return res.status(400).json({ success: false, error: 'Image file is required' });\n    }\n\n    const uploadedPath = req.file.path;\n    let finalImagePath = uploadedPath;\n    \n    // Convert to QCOW2 if not already in that format\n    const convertedPath = await qemuManager.ensureQcow2Format(uploadedPath);\n    if (convertedPath !== uploadedPath) {\n      finalImagePath = convertedPath;\n      // Clean up original file if conversion created a new one\n      try {\n        await fs.unlink(uploadedPath);\n      } catch (err) {\n        console.warn('Could not delete original file:', err.message);\n      }\n    }\n\n    const image = await qemuManager.resolveImage({\n      imageType: 'custom',\n      customImageName: path.basename(finalImagePath)\n    });\n\n    res.status(201).json({\n      success: true,\n      image\n    });\n  } catch (error) {\n    console.error('Error uploading image:', error);\n    // Clean up on error\n    if (req.file && req.file.path) {\n      try {\n        await fs.unlink(req.file.path);\n      } catch (err) {\n        console.warn('Could not delete uploaded file:', err.message);\n      }\n    }\n    res.status(500).json({ success: false, error: error.message || 'Failed to upload image' });\n  }\n});\n\n// =======================\n// ERROR HANDLERS\n// =======================\n\n// 404 handler\napp.use((req, res) => {\n  res.status(404).json({\n    success: false,\n    error: 'Endpoint not found',\n    path: req.url\n  });\n});\n\n// Global error handler\napp.use((err, req, res, next) => {\n  console.error('Unhandled error:', err);\n  res.status(500).json({\n    success: false,\n    error: err.message || 'Internal server error'\n  });\n});\n\n// =======================\n// SERVER STARTUP\n// =======================\n\nasync function initializeServer() {\n  try {\n    // Initialize managers\n    await nodeManager.initialize();\n    await guacamoleClient.initialize();\n    await qemuManager.initialize();\n    \n    // Start server\n    httpServer = http.createServer(app);\n    wsServer = new WebSocketServer({ noServer: true });\n\n    wsServer.on('connection', async (socket, request) => {\n      try {\n        const searchParams = request?.sandlabx?.searchParams;\n        const nodeId = searchParams ? searchParams.get('nodeId') : null;\n        if (!nodeId) {\n          socket.send(JSON.stringify({ type: 'error', message: 'nodeId query parameter required' }));\n          socket.close(1008, 'nodeId required');\n          return;\n        }\n\n        const node = await nodeManager.getNode(nodeId);\n        if (!node) {\n          socket.send(JSON.stringify({ type: 'error', message: 'Node not found' }));\n          socket.close(1008, 'Node not found');\n          return;\n        }\n\n        if (node.status !== 'running') {\n          socket.send(JSON.stringify({ type: 'error', message: 'Node is not running' }));\n          socket.close(1008, 'Node not running');\n          return;\n        }\n\n        try {\n          qemuManager.attachConsoleClient(nodeId, socket);\n        } catch (error) {\n          socket.send(JSON.stringify({ type: 'error', message: error.message }));\n          socket.close(1011, 'Console unavailable');\n        }\n      } catch (error) {\n        console.error('WebSocket connection error:', error.message);\n        try {\n          socket.send(JSON.stringify({ type: 'error', message: 'Server error' }));\n        } catch (sendError) {\n          console.error('WebSocket send error:', sendError.message);\n        }\n        socket.close(1011, 'Server error');\n      }\n    });\n\n    httpServer.on('upgrade', (request, socket, head) => {\n      try {\n        const parsedUrl = new URL(request.url, `http://${request.headers.host}`);\n        if (parsedUrl.pathname === '/ws/console') {\n          request.sandlabx = { searchParams: parsedUrl.searchParams };\n          wsServer.handleUpgrade(request, socket, head, (ws) => {\n            ws.sandlabx = request.sandlabx;\n            wsServer.emit('connection', ws, request);\n          });\n        } else {\n          socket.destroy();\n        }\n      } catch (error) {\n        console.error('Upgrade error:', error.message);\n        socket.destroy();\n      }\n    });\n\n    httpServer.listen(PORT, '0.0.0.0', () => {\n      console.log('='.repeat(60));\n      console.log('üöÄ SandBoxLabs Backend API Server');\n      console.log('='.repeat(60));\n      console.log(`‚úÖ Server running on: http://localhost:${PORT}`);\n      console.log(`‚úÖ API base URL: http://localhost:${PORT}/api`);\n      console.log(`‚úÖ Environment: ${process.env.NODE_ENV}`);\n      console.log(`‚úÖ Guacamole: ${process.env.GUAC_BASE_URL}`);\n      console.log('='.repeat(60));\n      console.log('\\nüìã Available Endpoints:');\n      console.log('  GET    /api/health          - Health check');\n      console.log('  GET    /api/nodes           - List all nodes');\n      console.log('  GET    /api/nodes/:id       - Get node details');\n      console.log('  POST   /api/nodes           - Create new node');\n      console.log('  POST   /api/nodes/:id/run   - Start node');\n      console.log('  POST   /api/nodes/:id/stop  - Stop node');\n      console.log('  POST   /api/nodes/:id/wipe  - Wipe node');\n      console.log('  DELETE /api/nodes/:id       - Delete node');\n      console.log('='.repeat(60));\n      console.log('\\nüéÆ Ready to accept requests!\\n');\n    });\n  } catch (error) {\n    console.error('Failed to initialize server:', error);\n    process.exit(1);\n  }\n}\n\n// Graceful shutdown\nprocess.on('SIGTERM', async () => {\n  console.log('\\n‚ö†Ô∏è  SIGTERM received, shutting down gracefully...');\n  await qemuManager.cleanup();\n  if (wsServer) {\n    wsServer.clients.forEach(client => client.close(1001, 'Server shutting down'));\n    wsServer.close();\n  }\n  if (httpServer) {\n    httpServer.close(() => process.exit(0));\n    return;\n  }\n  process.exit(0);\n});\n\nprocess.on('SIGINT', async () => {\n  console.log('\\n‚ö†Ô∏è  SIGINT received, shutting down gracefully...');\n  await qemuManager.cleanup();\n  if (wsServer) {\n    wsServer.clients.forEach(client => client.close(1001, 'Server shutting down'));\n    wsServer.close();\n  }\n  if (httpServer) {\n    httpServer.close(() => process.exit(0));\n    return;\n  }\n  process.exit(0);\n});\n\n// Start the server\ninitializeServer();",
    "backend/start-backend.sh": "#!/bin/bash\n\n# SandBoxLabs - Start Backend API Server\n# This script starts the Node.js backend API server\n\nset -e\n\nSCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)\"\ncd \"$SCRIPT_DIR\"\n\necho \"=========================================\"\necho \" SandBoxLabs Backend API Server\"\necho \"=========================================\"\necho \"\"\n\n# Check if Node.js is installed\nif ! command -v node &> /dev/null; then\n    echo \"‚ùå Error: Node.js is not installed\"\n    echo \"   Please install Node.js 18+ from https://nodejs.org/\"\n    exit 1\nfi\n\necho \"‚úÖ Node.js version: $(node --version)\"\n\n# Check if dependencies are installed\nif [ ! -d \"node_modules\" ]; then\n    echo \"\"\n    echo \"üì¶ Installing dependencies...\"\n    npm install\nfi\n\n# Check if .env file exists\nif [ ! -f \".env\" ]; then\n    echo \"\"\n    echo \"‚ö†Ô∏è  Warning: .env file not found\"\n    echo \"   Using default configuration\"\nfi\n\n# Check if QEMU is installed\nif ! command -v qemu-system-x86_64 &> /dev/null; then\n    echo \"\"\n    echo \"‚ö†Ô∏è  Warning: QEMU is not installed\"\n    echo \"   VMs will not be able to start\"\n    echo \"   Install: sudo apt-get install qemu-system-x86 qemu-utils\"\nfi\n\necho \"\"\necho \"üöÄ Starting backend server...\"\necho \"   Press Ctrl+C to stop\"\necho \"\"\necho \"=========================================\"\necho \"\"\n\n# Start the server\nnpm start",
    "frontend/app/globals.css": "@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: #0a0e27;\n  --foreground: #ffffff;\n}\n\nbody {\n  color: var(--foreground);\n  background: var(--background);\n  font-family: var(--font-inter), -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n  position: relative;\n  overflow-x: hidden;\n}\n\n/* Animated background gradient */\nbody::before {\n  content: '';\n  position: fixed;\n  top: -50%;\n  left: -50%;\n  width: 200%;\n  height: 200%;\n  background: radial-gradient(\n    circle at 20% 50%,\n    rgba(59, 130, 246, 0.08) 0%,\n    transparent 50%\n  ),\n  radial-gradient(\n    circle at 80% 80%,\n    rgba(147, 51, 234, 0.08) 0%,\n    transparent 50%\n  ),\n  radial-gradient(\n    circle at 40% 90%,\n    rgba(6, 182, 212, 0.06) 0%,\n    transparent 50%\n  );\n  animation: gradientMove 20s ease-in-out infinite;\n  z-index: 0;\n  pointer-events: none;\n}\n\n@keyframes gradientMove {\n  0%, 100% {\n    transform: translate(0, 0) rotate(0deg);\n  }\n  33% {\n    transform: translate(5%, -5%) rotate(1deg);\n  }\n  66% {\n    transform: translate(-5%, 5%) rotate(-1deg);\n  }\n}\n\n/* Ensure content stays above background */\nbody > * {\n  position: relative;\n  z-index: 1;\n}\n\n@layer utilities {\n  .text-balance {\n    text-wrap: balance;\n  }\n}\n\n/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: #1e293b;\n}\n\n::-webkit-scrollbar-thumb {\n  background: #475569;\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: #64748b;\n}\n\n/* Grid pattern background */\n.grid-pattern {\n  background-image: \n    linear-gradient(to right, rgba(255,255,255,0.03) 1px, transparent 1px),\n    linear-gradient(to bottom, rgba(255,255,255,0.03) 1px, transparent 1px);\n  background-size: 50px 50px;\n}",
    "frontend/app/layout.tsx": "import type { Metadata } from 'next'\nimport { Inter, Geist_Mono } from 'next/font/google'\nimport './globals.css'\n\nconst inter = Inter({ \n  subsets: ['latin'],\n  variable: '--font-inter',\n  display: 'swap',\n})\n\nconst geistMono = Geist_Mono({\n  subsets: ['latin'],\n  variable: '--font-geist-mono',\n  display: 'swap',\n})\n\nexport const metadata: Metadata = {\n  title: 'SandLabX - Network Lab',\n  description: 'Manage virtual network nodes with QEMU and Guacamole',\n}\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <html lang=\"en\" className={`${inter.variable} ${geistMono.variable}`}>\n      <body className=\"antialiased font-sans\">{children}</body>\n    </html>\n  )\n}",
    "frontend/app/page.tsx": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport dynamic from 'next/dynamic';\nimport type { Node, CreateNodeRequest } from '../lib/types';\nimport { Button } from '../components/Button';\nimport { NodeCard } from '../components/NodeCard';\nimport { CreateNodeModal } from '../components/CreateNodeModal';\nimport { apiClient } from '../lib/api';\n\nconst GuacamoleViewer = dynamic(\n  () => import('../components/GuacamoleViewer').then((mod) => mod.GuacamoleViewer),\n  { ssr: false }\n);\n\nexport default function Home() {\n  const [nodes, setNodes] = useState<Node[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);\n  const [selectedNode, setSelectedNode] = useState<Node | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  // Load nodes on component mount\n  useEffect(() => {\n    loadNodes();\n  }, []);\n\n  const loadNodes = async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await apiClient.listNodes();\n      if (response.success && response.data) {\n        setNodes(response.data.nodes);\n      } else {\n        setError(response.error || 'Failed to load nodes');\n        setNodes([]); // Empty state if API fails\n      }\n    } catch (err) {\n      setError('Failed to connect to backend API. Is the backend running?');\n      console.error('Load nodes error:', err);\n      setNodes([]); // Empty state on error\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateNode = async (data: CreateNodeRequest) => {\n    try {\n      const response = await apiClient.createNode(data);\n      if (response.success && response.data) {\n        await loadNodes(); // Reload list\n      } else {\n        throw new Error(response.error || 'Failed to create node');\n      }\n    } catch (err) {\n      console.error('Create node error:', err);\n      alert('Failed to create node: ' + (err instanceof Error ? err.message : 'Unknown error'));\n      throw err;\n    }\n  };\n\n  const handleStartNode = async (id: string) => {\n    try {\n      const response = await apiClient.startNode(id);\n      if (response.success) {\n        await loadNodes();\n      } else {\n        throw new Error(response.error || 'Failed to start node');\n      }\n    } catch (err) {\n      console.error('Start node error:', err);\n      alert('Failed to start node: ' + (err instanceof Error ? err.message : 'Unknown error'));\n      throw err;\n    }\n  };\n\n  const handleStopNode = async (id: string) => {\n    try {\n      const response = await apiClient.stopNode(id);\n      if (response.success) {\n        await loadNodes();\n      } else {\n        throw new Error(response.error || 'Failed to stop node');\n      }\n    } catch (err) {\n      console.error('Stop node error:', err);\n      alert('Failed to stop node: ' + (err instanceof Error ? err.message : 'Unknown error'));\n      throw err;\n    }\n  };\n\n  const handleWipeNode = async (id: string) => {\n    try {\n      const response = await apiClient.wipeNode(id);\n      if (response.success) {\n        await loadNodes();\n      } else {\n        throw new Error(response.error || 'Failed to wipe node');\n      }\n    } catch (err) {\n      console.error('Wipe node error:', err);\n      alert('Failed to wipe node: ' + (err instanceof Error ? err.message : 'Unknown error'));\n      throw err;\n    }\n  };\n\n  const handleDeleteNode = async (id: string) => {\n    try {\n      const response = await apiClient.deleteNode(id);\n      if (response.success) {\n        await loadNodes(); // Reload the list - deleted node will be gone\n      } else {\n        throw new Error(response.error || 'Failed to delete node');\n      }\n    } catch (err) {\n      console.error('Delete node error:', err);\n      alert('Failed to delete node: ' + (err instanceof Error ? err.message : 'Unknown error'));\n      throw err;\n    }\n  };\n\n  const handleConnectNode = (node: Node) => {\n    if (node.guacUrl) {\n      setSelectedNode(node);\n    }\n  };\n\n  return (\n    <>\n      {/* Guacamole Viewer */}\n      {selectedNode && (\n        <GuacamoleViewer\n          node={selectedNode}\n          onClose={() => setSelectedNode(null)}\n        />\n      )}\n\n      {/* Main Content */}\n      <div className=\"min-h-screen bg-lab-darker grid-pattern\">\n        {/* Header */}\n        <header className=\"bg-lab-gray/50 backdrop-blur-md border-b border-lab-gray-light sticky top-0 z-40\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"w-10 h-10 bg-gradient-to-br from-lab-primary to-lab-secondary rounded-lg flex items-center justify-center\">\n                  <span className=\"text-2xl\">‚ö°</span>\n                </div>\n                <div>\n                  <h1 className=\"text-2xl font-bold text-white\">SandLabX</h1>\n                  <p className=\"text-sm text-gray-400\">Network Lab Environment</p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-4\">\n                <div className=\"hidden sm:flex items-center gap-2 text-sm\">\n                  <div className=\"flex items-center gap-1.5 px-3 py-1.5 bg-lab-accent/20 text-lab-accent rounded-full\">\n                    <span className=\"animate-pulse-glow\">‚óè</span>\n                    <span>{nodes.filter(n => n.status === 'running').length} Running</span>\n                  </div>\n                  <div className=\"flex items-center gap-1.5 px-3 py-1.5 bg-lab-gray text-gray-300 rounded-full\">\n                    <span>‚óã</span>\n                    <span>{nodes.filter(n => n.status === 'stopped').length} Stopped</span>\n                  </div>\n                </div>\n                <Button\n                  variant=\"primary\"\n                  onClick={() => setIsCreateModalOpen(true)}\n                  icon={<span>+</span>}\n                >\n                  Add Node\n                </Button>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        {/* Main Content */}\n        <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          {/* Stats */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\">\n            <div className=\"bg-lab-gray rounded-xl p-6 border border-lab-gray-light\">\n              <p className=\"text-gray-400 text-sm mb-1\">Total Nodes</p>\n              <p className=\"text-3xl font-bold text-white\">{nodes.length}</p>\n            </div>\n            <div className=\"bg-lab-gray rounded-xl p-6 border border-lab-gray-light\">\n              <p className=\"text-gray-400 text-sm mb-1\">Running</p>\n              <p className=\"text-3xl font-bold text-lab-accent\">\n                {nodes.filter(n => n.status === 'running').length}\n              </p>\n            </div>\n            <div className=\"bg-lab-gray rounded-xl p-6 border border-lab-gray-light\">\n              <p className=\"text-gray-400 text-sm mb-1\">Stopped</p>\n              <p className=\"text-3xl font-bold text-gray-300\">\n                {nodes.filter(n => n.status === 'stopped').length}\n              </p>\n            </div>\n            <div className=\"bg-lab-gray rounded-xl p-6 border border-lab-gray-light\">\n              <p className=\"text-gray-400 text-sm mb-1\">Total vCPUs</p>\n              <p className=\"text-3xl font-bold text-white\">\n                {nodes.reduce((sum, n) => sum + (n.resources.cpus || n.resources.cpu || 0), 0)}\n              </p>\n            </div>\n          </div>\n\n          {/* Error Message */}\n          {error && (\n            <div className=\"bg-lab-danger/20 border border-lab-danger rounded-xl p-4 mb-6\">\n              <p className=\"text-lab-danger\">‚ö†Ô∏è {error}</p>\n            </div>\n          )}\n\n          {/* Loading State */}\n          {loading && (\n            <div className=\"flex items-center justify-center py-20\">\n              <div className=\"text-center\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-lab-primary mx-auto mb-4\"></div>\n                <p className=\"text-gray-400\">Loading nodes...</p>\n              </div>\n            </div>\n          )}\n\n          {/* Empty State */}\n          {!loading && nodes.length === 0 && (\n            <div className=\"bg-lab-gray rounded-xl border border-lab-gray-light p-12 text-center\">\n              <div className=\"max-w-md mx-auto\">\n                <div className=\"text-6xl mb-4\">üöÄ</div>\n                <h3 className=\"text-xl font-semibold text-white mb-2\">\n                  No nodes yet\n                </h3>\n                <p className=\"text-gray-400 mb-6\">\n                  Create your first virtual node to get started with your network lab.\n                </p>\n                <Button\n                  variant=\"primary\"\n                  onClick={() => setIsCreateModalOpen(true)}\n                  icon={<span>+</span>}\n                >\n                  Create First Node\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/* Nodes Grid */}\n          {!loading && nodes.length > 0 && (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {nodes.map((node) => (\n                <NodeCard\n                  key={node.id}\n                  node={node}\n                  onStart={handleStartNode}\n                  onStop={handleStopNode}\n                  onWipe={handleWipeNode}\n                  onDelete={handleDeleteNode}\n                  onConnect={handleConnectNode}\n                />\n              ))}\n            </div>\n          )}\n        </main>\n      </div>\n\n      {/* Create Node Modal */}\n      <CreateNodeModal\n        isOpen={isCreateModalOpen}\n        onClose={() => setIsCreateModalOpen(false)}\n        onCreate={handleCreateNode}\n      />\n    </>\n  );\n}",
    "frontend/components/Button.tsx": "import React from 'react';\n\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: 'primary' | 'secondary' | 'danger' | 'ghost';\n  size?: 'sm' | 'md' | 'lg';\n  loading?: boolean;\n  icon?: React.ReactNode;\n}\n\nexport const Button: React.FC<ButtonProps> = ({\n  children,\n  variant = 'primary',\n  size = 'md',\n  loading = false,\n  icon,\n  className = '',\n  disabled,\n  ...props\n}) => {\n  const baseStyles = 'inline-flex items-center justify-center font-medium transition-all duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-lab-dark disabled:opacity-50 disabled:cursor-not-allowed';\n  \n  const variants = {\n    primary: 'bg-lab-primary text-lab-darker hover:bg-lab-primary/90 focus:ring-lab-primary',\n    secondary: 'bg-lab-gray hover:bg-lab-gray-light text-white focus:ring-lab-gray',\n    danger: 'bg-lab-danger hover:bg-lab-danger/90 text-white focus:ring-lab-danger',\n    ghost: 'bg-transparent hover:bg-lab-gray/50 text-white focus:ring-lab-gray',\n  };\n  \n  const sizes = {\n    sm: 'px-3 py-1.5 text-sm',\n    md: 'px-4 py-2 text-base',\n    lg: 'px-6 py-3 text-lg',\n  };\n\n  return (\n    <button\n      className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className}`}\n      disabled={disabled || loading}\n      {...props}\n    >\n      {loading && (\n        <svg\n          className=\"animate-spin -ml-1 mr-2 h-4 w-4\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n        >\n          <circle\n            className=\"opacity-25\"\n            cx=\"12\"\n            cy=\"12\"\n            r=\"10\"\n            stroke=\"currentColor\"\n            strokeWidth=\"4\"\n          ></circle>\n          <path\n            className=\"opacity-75\"\n            fill=\"currentColor\"\n            d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n          ></path>\n        </svg>\n      )}\n      {icon && <span className=\"mr-2\">{icon}</span>}\n      {children}\n    </button>\n  );\n};",
    "frontend/components/CreateNodeModal.tsx": "'use client';\n\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport type { BaseImageType, CreateNodeRequest, ImageInfo, ImageSourceType } from '../lib/types';\nimport { Button } from './Button';\nimport { baseImages } from '../lib/mockData';\nimport { apiClient } from '../lib/api';\n\ninterface CreateNodeModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onCreate: (data: CreateNodeRequest) => Promise<void>;\n}\n\nexport const CreateNodeModal: React.FC<CreateNodeModalProps> = ({\n  isOpen,\n  onClose,\n  onCreate,\n}) => {\n  const [loading, setLoading] = useState(false);\n  const [imageLoading, setImageLoading] = useState(false);\n  const [imageError, setImageError] = useState<string | null>(null);\n  const [imageSelection, setImageSelection] = useState<{ type: ImageSourceType; id: string | null }>({ type: 'base', id: 'ubuntu' });\n  const [nodeName, setNodeName] = useState('');\n  const [resources, setResources] = useState({\n    cpu: 2,\n    ram: 2048,\n    disk: 10,\n  });\n  const [customImages, setCustomImages] = useState<ImageInfo[]>([]);\n  const [baseOptions, setBaseOptions] = useState<ImageInfo[]>([]);\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n\n  // Added memoised fallback list for offline usage\n  const fallbackBaseOptions = useMemo<ImageInfo[]>(() => baseImages.map((img) => ({\n    type: 'base' as const,\n    id: img.type,\n    name: img.name,\n    description: img.description,\n    path: '',\n    size: img.size,\n    sizeBytes: 0,\n    available: img.available,\n  })), []);\n\n  useEffect(() => {\n    if (!isOpen) {\n      return;\n    }\n\n    let isCancelled = false;\n    const loadImages = async () => {\n      setImageLoading(true);\n      setImageError(null);\n      try {\n        const response = await apiClient.listImages();\n        if (isCancelled) {\n          return;\n        }\n        if (response.success && response.data) {\n          setBaseOptions(response.data.baseImages);\n          setCustomImages(response.data.customImages);\n        } else {\n          setImageError(response.error || 'Failed to load images');\n          setBaseOptions(fallbackBaseOptions);\n        }\n      } catch (error) {\n        if (!isCancelled) {\n          setImageError(error instanceof Error ? error.message : 'Failed to load images');\n          setBaseOptions(fallbackBaseOptions);\n        }\n      } finally {\n        if (!isCancelled) {\n          setImageLoading(false);\n        }\n      }\n    };\n\n    loadImages();\n\n    return () => {\n      isCancelled = true;\n    };\n  }, [fallbackBaseOptions, isOpen]);\n\n  if (!isOpen) return null;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!imageSelection.id) {\n      alert('Select an image before creating the node.');\n      return;\n    }\n    setLoading(true);\n    try {\n      await onCreate({\n        name: nodeName || undefined,\n        imageType: imageSelection.type,\n        baseImage: imageSelection.type === 'base' ? (imageSelection.id as BaseImageType) : undefined,\n        customImageName: imageSelection.type === 'custom' ? imageSelection.id ?? undefined : undefined,\n        resources,\n      });\n      // Reset form\n      setNodeName('');\n      setImageSelection({ type: 'base', id: 'ubuntu' });\n      setResources({ cpu: 2, ram: 2048, disk: 10 });\n      onClose();\n    } catch (error) {\n      console.error('Failed to create node:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCustomUploadClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileSelected = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) {\n      return;\n    }\n\n    setUploading(true);\n    setImageError(null);\n    try {\n      const response = await apiClient.uploadCustomImage(file);\n      if (response.success && response.data?.image) {\n        const uploaded = response.data.image;\n        setCustomImages((prev) => [...prev, uploaded]);\n        setImageSelection({ type: 'custom', id: uploaded.id });\n      } else {\n        throw new Error(response.error || 'Upload failed');\n      }\n    } catch (error) {\n      console.error('Custom image upload failed:', error);\n      setImageError(error instanceof Error ? error.message : 'Failed to upload image');\n    } finally {\n      setUploading(false);\n      if (event.target) {\n        event.target.value = '';\n      }\n    }\n  };\n\n  const renderImageCard = (image: ImageInfo, disabled: boolean, isActive: boolean, onSelect: () => void) => (\n    <button\n      key={`${image.type}-${image.id}`}\n      type=\"button\"\n      onClick={() => !disabled && onSelect()}\n      disabled={disabled}\n      className={`\n        relative p-4 rounded-lg border-2 transition-all text-left\n        ${isActive ? 'border-lab-primary bg-lab-primary/10' : 'border-lab-gray-light bg-lab-darker'}\n        ${disabled ? 'opacity-50 cursor-not-allowed' : 'hover:border-lab-primary/50 cursor-pointer'}\n      `}\n    >\n      <div className=\"flex items-start justify-between mb-2\">\n        <h3 className=\"font-semibold text-white\">{image.name || image.id}</h3>\n        {!image.available && (\n          <span className=\"text-xs bg-lab-warning/20 text-lab-warning px-2 py-1 rounded\">\n            Unavailable\n          </span>\n        )}\n      </div>\n      <p className=\"text-sm text-gray-400 mb-2\">\n        {image.description || (image.type === 'custom' ? 'User provided image' : 'Base image')}\n      </p>\n      <p className=\"text-xs text-gray-500\">Size: {image.size}</p>\n      {isActive && (\n        <div className=\"absolute top-2 right-2\">\n          <div className=\"w-6 h-6 bg-lab-primary rounded-full flex items-center justify-center\">\n            <svg\n              className=\"w-4 h-4 text-lab-darker\"\n              fill=\"currentColor\"\n              viewBox=\"0 0 20 20\"\n            >\n              <path\n                fillRule=\"evenodd\"\n                d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"\n                clipRule=\"evenodd\"\n              />\n            </svg>\n          </div>\n        </div>\n      )}\n    </button>\n  );\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm\">\n      <div className=\"bg-lab-gray rounded-2xl border border-lab-gray-light max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-lab-gray-light\">\n          <h2 className=\"text-2xl font-bold text-white\">Create New Node</h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-white transition-colors\"\n          >\n            <svg\n              className=\"w-6 h-6\"\n              fill=\"none\"\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth=\"2\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path d=\"M6 18L18 6M6 6l12 12\"></path>\n            </svg>\n          </button>\n        </div>\n\n        {/* Form */}\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\n          {/* Node Name */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Node Name (optional)\n            </label>\n            <input\n              type=\"text\"\n              value={nodeName}\n              onChange={(e) => setNodeName(e.target.value)}\n              placeholder=\"e.g., dev-server-1\"\n              className=\"w-full bg-lab-darker border border-lab-gray-light rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-lab-primary\"\n            />\n            <p className=\"mt-1 text-xs text-gray-500\">\n              Auto-generated if left empty\n            </p>\n          </div>\n\n          {/* Base Image Selection */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-3\">\n              Select Base Image\n            </label>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n              {(baseOptions.length ? baseOptions : fallbackBaseOptions).map((image) =>\n                renderImageCard(\n                  image,\n                  !image.available,\n                  imageSelection.type === 'base' && imageSelection.id === image.id,\n                  () => setImageSelection({ type: 'base', id: image.id })\n                )\n              )}\n            </div>\n            {imageError && (\n              <p className=\"mt-2 text-xs text-lab-warning\">‚ö†Ô∏è {imageError}</p>\n            )}\n            {imageLoading && (\n              <p className=\"mt-2 text-xs text-gray-400\">Loading image catalogue‚Ä¶</p>\n            )}\n          </div>\n\n          {/* Custom Images */}\n          <div>\n            <div className=\"flex items-center justify-between mb-3\">\n              <label className=\"block text-sm font-medium text-gray-300\">\n                Custom QCOW2 Images\n              </label>\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"file\"\n                  accept=\".qcow2\"\n                  ref={fileInputRef}\n                  onChange={handleFileSelected}\n                  className=\"hidden\"\n                />\n                <Button\n                  type=\"button\"\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  onClick={handleCustomUploadClick}\n                  loading={uploading}\n                >\n                  Upload QCOW2\n                </Button>\n              </div>\n            </div>\n            {customImages.length === 0 && (\n              <p className=\"text-xs text-gray-500\">No custom images uploaded yet.</p>\n            )}\n            {customImages.length > 0 && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                {customImages.map((image) =>\n                  renderImageCard(\n                    image,\n                    !image.available,\n                    imageSelection.type === 'custom' && imageSelection.id === image.id,\n                    () => setImageSelection({ type: 'custom', id: image.id })\n                  )\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Resources */}\n          <div className=\"space-y-4\">\n            <label className=\"block text-sm font-medium text-gray-300\">\n              Resources\n            </label>\n            \n            {/* CPU */}\n            <div>\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-sm text-gray-400\">CPU Cores</span>\n                <span className=\"text-sm font-semibold text-white\">\n                  {resources.cpu}\n                </span>\n              </div>\n              <input\n                type=\"range\"\n                min=\"1\"\n                max=\"8\"\n                value={resources.cpu}\n                onChange={(e) =>\n                  setResources({ ...resources, cpu: parseInt(e.target.value) })\n                }\n                className=\"w-full\"\n              />\n            </div>\n\n            {/* RAM */}\n            <div>\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-sm text-gray-400\">RAM (MB)</span>\n                <span className=\"text-sm font-semibold text-white\">\n                  {resources.ram} MB\n                </span>\n              </div>\n              <input\n                type=\"range\"\n                min=\"512\"\n                max=\"8192\"\n                step=\"512\"\n                value={resources.ram}\n                onChange={(e) =>\n                  setResources({ ...resources, ram: parseInt(e.target.value) })\n                }\n                className=\"w-full\"\n              />\n            </div>\n\n            {/* Disk */}\n            <div>\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-sm text-gray-400\">Disk (GB)</span>\n                <span className=\"text-sm font-semibold text-white\">\n                  {resources.disk} GB\n                </span>\n              </div>\n              <input\n                type=\"range\"\n                min=\"5\"\n                max=\"100\"\n                step=\"5\"\n                value={resources.disk}\n                onChange={(e) =>\n                  setResources({ ...resources, disk: parseInt(e.target.value) })\n                }\n                className=\"w-full\"\n              />\n            </div>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex gap-3 pt-4\">\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              className=\"flex-1\"\n              onClick={onClose}\n              disabled={loading}\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              variant=\"primary\"\n              className=\"flex-1\"\n              loading={loading}\n            >\n              Create Node\n            </Button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};",
    "frontend/components/GuacamoleViewer.tsx": "'use client';\n\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Terminal } from '@xterm/xterm';\nimport { FitAddon } from '@xterm/addon-fit';\nimport '@xterm/xterm/css/xterm.css';\nimport type { Node } from '../lib/types';\nimport { Button } from './Button';\n\ninterface GuacamoleViewerProps {\n  node: Node | null;\n  onClose: () => void;\n}\n\nexport const GuacamoleViewer: React.FC<GuacamoleViewerProps> = ({\n  node,\n  onClose,\n}) => {\n  const [showControls, setShowControls] = useState(true);\n  const [showTooltip, setShowTooltip] = useState(false);\n  const [showConsole, setShowConsole] = useState(false);\n  const [consoleStatus, setConsoleStatus] = useState<'idle' | 'connecting' | 'ready' | 'error'>('idle');\n  const [consoleError, setConsoleError] = useState<string | null>(null);\n  const terminalRef = useRef<Terminal | null>(null);\n  const fitAddonRef = useRef<FitAddon | null>(null);\n  const wsRef = useRef<WebSocket | null>(null);\n  const terminalContainerRef = useRef<HTMLDivElement | null>(null);\n\n  if (!node || !node.guacUrl) return null;\n\n  const openInNewTab = () => {\n    window.open(node.guacUrl!, '_blank');\n  };\n\n  const sendCtrlAltDel = () => {\n    // This would need Guacamole API integration\n    alert('Ctrl+Alt+Del: This feature requires Guacamole keyboard API integration');\n  };\n\n  // Added helper to derive console websocket URL\n  const consoleUrl = useMemo(() => {\n    const apiBase = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001/api';\n    const stripped = apiBase.replace(/\\/?api\\/?$/, '');\n    const protocol = stripped.startsWith('https') ? 'wss' : 'ws';\n    const host = stripped.replace(/^https?:\\/\\//, '');\n    return `${protocol}://${host}/ws/console?nodeId=${node.id}`;\n  }, [node.id]);\n\n  useEffect(() => {\n    setShowConsole(false);\n    setConsoleStatus('idle');\n    setConsoleError(null);\n  }, [node.id]);\n\n  useEffect(() => {\n    if (!showConsole) {\n      return () => {};\n    }\n\n    const container = terminalContainerRef.current;\n    if (!container) {\n      return () => {};\n    }\n\n    setConsoleStatus('connecting');\n    setConsoleError(null);\n\n    const term = new Terminal({\n      theme: {\n        background: '#0b0f19',\n        foreground: '#f5f6f9',\n        cursor: '#4ade80',\n      },\n      cursorBlink: true,\n      fontSize: 14,\n    });\n    const fitAddon = new FitAddon();\n    term.loadAddon(fitAddon);\n    term.open(container);\n    fitAddon.fit();\n\n    terminalRef.current = term;\n    fitAddonRef.current = fitAddon;\n\n    const socket = new WebSocket(consoleUrl);\n    wsRef.current = socket;\n\n    const handleResize = () => {\n      try {\n        fitAddon.fit();\n      } catch (error) {\n        console.error('Console resize error:', error);\n      }\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    term.onData((data: string) => {\n      if (socket.readyState === WebSocket.OPEN) {\n        socket.send(data);\n      }\n    });\n\n    socket.onopen = () => {\n      setConsoleStatus('ready');\n    };\n\n    socket.onmessage = (event) => {\n      try {\n        const payload = JSON.parse(event.data);\n        if (payload.type === 'ready') {\n          setConsoleStatus('ready');\n          return;\n        }\n        if (payload.type === 'data') {\n          term.write(payload.payload);\n          return;\n        }\n        if (payload.type === 'error') {\n          setConsoleStatus('error');\n          setConsoleError(payload.message || 'Console error');\n          return;\n        }\n        if (payload.type === 'exit') {\n          term.writeln(`\\r\\n[Console closed: code=${payload.code ?? 'null'} signal=${payload.signal ?? 'null'}]`);\n          return;\n        }\n      } catch (error) {\n        term.write(event.data);\n      }\n    };\n\n    socket.onerror = () => {\n      setConsoleStatus('error');\n      setConsoleError('Console socket error');\n    };\n\n    socket.onclose = () => {\n      setConsoleStatus((status) => (status === 'error' ? status : 'idle'));\n      window.removeEventListener('resize', handleResize);\n    };\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\n        wsRef.current.close(1000, 'Console closed');\n      }\n      wsRef.current = null;\n      fitAddon.dispose();\n      term.dispose();\n      terminalRef.current = null;\n    };\n  }, [consoleUrl, showConsole]);\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-lab-darker\">\n      {/* Header with VM Controls */}\n      <div className=\"bg-lab-gray border-b border-lab-gray-light p-3\">\n        <div className=\"flex items-center justify-between\">\n          {/* Left: Back button and Node info */}\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\n              <svg\n                className=\"w-5 h-5\"\n                fill=\"none\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth=\"2\"\n                viewBox=\"0 0 24 24\"\n                stroke=\"currentColor\"\n              >\n                <path d=\"M10 19l-7-7m0 0l7-7m-7 7h18\"></path>\n              </svg>\n              Back to Dashboard\n            </Button>\n            <div className=\"border-l border-lab-gray-light pl-4\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                <h2 className=\"text-base font-semibold text-white\">{node.name}</h2>\n                <span className=\"text-xs text-gray-400 px-2 py-0.5 bg-lab-darker rounded\">\n                  VNC: {node.vncPort}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Center: VM Controls Toolbar */}\n          <div className=\"flex items-center gap-1 bg-lab-darker rounded-lg p-1\">\n            {/* Ctrl+Alt+Del */}\n            <button\n              onClick={sendCtrlAltDel}\n              className=\"px-3 py-1.5 text-xs text-gray-300 hover:text-white hover:bg-lab-gray rounded transition-colors\"\n              title=\"Send Ctrl+Alt+Del\"\n            >\n              <svg className=\"w-4 h-4 inline mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4\" />\n              </svg>\n              Ctrl+Alt+Del\n            </button>\n\n            <div className=\"w-px h-6 bg-lab-gray-light\"></div>\n\n            {/* Fullscreen Toggle */}\n            <button\n              onClick={() => {\n                const elem = document.querySelector('iframe');\n                if (elem) {\n                  if (document.fullscreenElement) {\n                    document.exitFullscreen();\n                  } else {\n                    elem.requestFullscreen();\n                  }\n                }\n              }}\n              className=\"px-3 py-1.5 text-xs text-gray-300 hover:text-white hover:bg-lab-gray rounded transition-colors\"\n              title=\"Fullscreen\"\n            >\n              <svg className=\"w-4 h-4 inline mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\" />\n              </svg>\n              Fullscreen\n            </button>\n\n            <div className=\"w-px h-6 bg-lab-gray-light\"></div>\n\n            {/* Screenshot */}\n            <button\n              className=\"px-3 py-1.5 text-xs text-gray-300 hover:text-white hover:bg-lab-gray rounded transition-colors\"\n              title=\"Screenshot\"\n            >\n              <svg className=\"w-4 h-4 inline mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\" />\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\" />\n              </svg>\n              Screenshot\n            </button>\n\n            <div className=\"w-px h-6 bg-lab-gray-light\"></div>\n\n            {/* Clipboard */}\n            <button\n              className=\"px-3 py-1.5 text-xs text-gray-300 hover:text-white hover:bg-lab-gray rounded transition-colors\"\n              title=\"Clipboard\"\n            >\n              <svg className=\"w-4 h-4 inline mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\n              </svg>\n              Clipboard\n            </button>\n          </div>\n\n          {/* Right: Additional controls */}\n          <div className=\"flex items-center gap-2\">\n            <div className=\"text-xs text-gray-400 px-3 py-1.5 bg-lab-darker rounded\">\n              <span className=\"text-gray-500\">RAM:</span> {node.resources.ram}MB\n              <span className=\"mx-2\">‚Ä¢</span>\n              <span className=\"text-gray-500\">CPU:</span> {node.resources.cpus || node.resources.cpu || 2} cores\n            </div>\n\n            <Button\n              variant={showConsole ? 'secondary' : 'ghost'}\n              size=\"sm\"\n              onClick={() => setShowConsole((prev) => !prev)}\n            >\n              {showConsole ? 'Hide Serial Console' : 'Show Serial Console'}\n            </Button>\n            \n            {/* Info tooltip */}\n            <div className=\"relative\">\n              <button\n                onMouseEnter={() => setShowTooltip(true)}\n                onMouseLeave={() => setShowTooltip(false)}\n                className=\"p-2 text-blue-400 hover:text-blue-300 hover:bg-lab-darker rounded transition-colors\"\n                title=\"Console interaction info\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n              </button>\n              \n              {/* Tooltip */}\n              {showTooltip && (\n                <div className=\"absolute right-0 top-full mt-2 w-72 bg-lab-gray border border-lab-gray-light rounded-lg shadow-2xl z-50 p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <svg className=\"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                    </svg>\n                    <div>\n                      <h4 className=\"text-sm font-semibold text-white mb-2\">Console Interaction</h4>\n                      <p className=\"text-xs text-gray-300 leading-relaxed\">\n                        If you're unable to interact with the VM console in this embedded view, \n                        click the <span className=\"text-blue-400 font-medium\">\"New Tab\"</span> button \n                        to open it in a separate window for full keyboard and mouse control.\n                      </p>\n                    </div>\n                  </div>\n                  {/* Arrow */}\n                  <div className=\"absolute -top-2 right-4 w-4 h-4 bg-lab-gray border-t border-l border-lab-gray-light rotate-45\"></div>\n                </div>\n              )}\n            </div>\n            \n            <Button variant=\"secondary\" size=\"sm\" onClick={openInNewTab}>\n              <svg\n                className=\"w-4 h-4 mr-1.5\"\n                fill=\"none\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth=\"2\"\n                viewBox=\"0 0 24 24\"\n                stroke=\"currentColor\"\n              >\n                <path d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"></path>\n              </svg>\n              New Tab\n            </Button>\n          </div>\n        </div>\n\n        {/* Secondary toolbar - Optional keyboard shortcuts */}\n        {showControls && (\n          <div className=\"mt-2 flex items-center gap-3 text-xs text-gray-500 px-2\">\n            <span className=\"flex items-center gap-1\">\n              <kbd className=\"px-1.5 py-0.5 bg-lab-darker rounded border border-lab-gray-light\">Ctrl</kbd>\n              <kbd className=\"px-1.5 py-0.5 bg-lab-darker rounded border border-lab-gray-light\">Alt</kbd>\n              <span>+ click for right-click</span>\n            </span>\n            <span>‚Ä¢</span>\n            <span className=\"flex items-center gap-1\">\n              <kbd className=\"px-1.5 py-0.5 bg-lab-darker rounded border border-lab-gray-light\">Ctrl</kbd>\n              <kbd className=\"px-1.5 py-0.5 bg-lab-darker rounded border border-lab-gray-light\">Alt</kbd>\n              <kbd className=\"px-1.5 py-0.5 bg-lab-darker rounded border border-lab-gray-light\">Shift</kbd>\n              <span>for clipboard</span>\n            </span>\n            <button \n              onClick={() => setShowControls(false)}\n              className=\"ml-auto text-gray-600 hover:text-gray-400\"\n            >\n              <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Console iframe */}\n      <div className=\"h-[calc(100vh-73px)] bg-black\">\n        <iframe\n          src={node.guacUrl}\n          className=\"w-full h-full border-0\"\n          title={`Console for ${node.name}`}\n          allow=\"clipboard-read; clipboard-write\"\n          sandbox=\"allow-same-origin allow-scripts allow-forms allow-popups\"\n        />\n      </div>\n\n      {showConsole && (\n        <div className=\"absolute inset-x-0 bottom-0 bg-[#0b0f19] border-t border-lab-gray-light/60 shadow-xl\">\n          <div className=\"flex items-center justify-between px-4 py-2 border-b border-lab-gray-light/40\">\n            <div className=\"flex items-center gap-2 text-xs text-gray-400\">\n              <span className=\"uppercase tracking-wide text-gray-300\">Serial Console</span>\n              <span>‚Ä¢</span>\n              <span className={\n                consoleStatus === 'ready'\n                  ? 'text-green-400'\n                  : consoleStatus === 'connecting'\n                    ? 'text-yellow-400'\n                    : 'text-red-400'\n              }>\n                {consoleStatus === 'ready' && 'Connected'}\n                {consoleStatus === 'connecting' && 'Connecting'}\n                {consoleStatus === 'error' && 'Error'}\n                {consoleStatus === 'idle' && 'Idle'}\n              </span>\n              {consoleError && <span className=\"text-lab-warning\">‚Ä¢ {consoleError}</span>}\n            </div>\n            <Button size=\"sm\" variant=\"ghost\" onClick={() => setShowConsole(false)}>\n              Close\n            </Button>\n          </div>\n          <div className=\"h-64 overflow-hidden\">\n            <div ref={terminalContainerRef} className=\"w-full h-full\" />\n          </div>\n        </div>\n      )}\n\n      {/* Connection info overlay (bottom right) */}\n      <div className=\"absolute bottom-4 right-4 bg-lab-gray/90 backdrop-blur-sm border border-lab-gray-light rounded-lg p-3 text-xs\">\n        <div className=\"flex items-center gap-2 text-green-400 mb-1\">\n          <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n          <span className=\"font-semibold\">Connected</span>\n        </div>\n        <div className=\"text-gray-400 space-y-0.5\">\n          <div>Protocol: <span className=\"text-white\">VNC</span></div>\n          <div>Port: <span className=\"text-white\">{node.vncPort}</span></div>\n          <div>Status: <span className=\"text-green-400\">Active</span></div>\n        </div>\n      </div>\n    </div>\n  );\n};",
    "frontend/components/NodeCard.tsx": "'use client';\n\nimport React, { useState } from 'react';\nimport type { Node } from '../lib/types';\nimport { Button } from './Button';\nimport { StatusBadge } from './StatusBadge';\n\ninterface NodeCardProps {\n  node: Node;\n  onStart: (id: string) => Promise<void>;\n  onStop: (id: string) => Promise<void>;\n  onWipe: (id: string) => Promise<void>;\n  onDelete: (id: string) => Promise<void>;\n  onConnect: (node: Node) => void;\n}\n\nexport const NodeCard: React.FC<NodeCardProps> = ({\n  node,\n  onStart,\n  onStop,\n  onWipe,\n  onDelete,\n  onConnect,\n}) => {\n  const [loading, setLoading] = useState<string | null>(null);\n  const [showWipeConfirm, setShowWipeConfirm] = useState(false);\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n\n  const handleAction = async (action: () => Promise<void>, actionName: string) => {\n    setLoading(actionName);\n    try {\n      await action();\n    } finally {\n      setLoading(null);\n    }\n  };\n\n  const handleWipeClick = () => {\n    if (!showWipeConfirm) {\n      setShowWipeConfirm(true);\n      setTimeout(() => setShowWipeConfirm(false), 5000); // Auto-hide after 5s\n      return;\n    }\n    handleAction(() => onWipe(node.id), 'wipe');\n    setShowWipeConfirm(false);\n  };\n\n  const handleDeleteClick = () => {\n    if (!showDeleteConfirm) {\n      setShowDeleteConfirm(true);\n      setTimeout(() => setShowDeleteConfirm(false), 5000); // Auto-hide after 5s\n      return;\n    }\n    handleAction(() => onDelete(node.id), 'delete');\n    setShowDeleteConfirm(false);\n  };\n\n  const getImageIcon = (type: string) => {\n    const icons: Record<string, string> = {\n      ubuntu: 'üêß',\n      alpine: 'üèîÔ∏è',\n      debian: 'üåÄ',\n      fedora: 'üé©',\n      arch: 'üîß',\n      custom: 'üß©',\n    };\n    return icons[type] || 'üíª';\n  };\n\n  const getImageName = (type: string) => {\n    const names: Record<string, string> = {\n      ubuntu: 'Ubuntu 24 LTS',\n      alpine: 'Alpine Linux',\n      debian: 'Debian 13',\n      fedora: 'Fedora',\n      arch: 'Arch Linux',\n      custom: 'Custom Image',\n    };\n    return names[type] || 'Unknown OS';\n  };\n\n  const osType = node.osType || node.baseImage || 'ubuntu';\n  const imageName = node.image?.name || getImageName(osType);\n  const imageIcon = getImageIcon(osType);\n\n  return (\n    <div className=\"group bg-gradient-to-br from-lab-gray to-lab-gray/50 rounded-2xl border border-lab-gray-light hover:border-lab-primary/60 transition-all duration-500 overflow-hidden shadow-lg hover:shadow-lab-primary/20 hover:scale-[1.02]\">\n      {/* Header with gradient */}\n      <div className=\"relative p-5 border-b border-lab-gray-light bg-gradient-to-r from-lab-primary/5 to-lab-secondary/5\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"text-4xl filter drop-shadow-lg group-hover:scale-110 transition-transform duration-300\">\n              {imageIcon}\n            </div>\n            <div>\n              <h3 className=\"text-xl font-bold text-white mb-1 tracking-tight\">{node.name}</h3>\n              <p className=\"text-xs text-gray-400 font-mono bg-lab-darker/50 px-2 py-1 rounded inline-block\">\n                {node.id.substring(0, 13)}...\n              </p>\n            </div>\n          </div>\n          <div className=\"flex flex-col items-end gap-2\">\n            <StatusBadge status={node.status} />\n          </div>\n        </div>\n      </div>\n\n      {/* Details with better spacing */}\n      <div className=\"p-5 space-y-4\">\n        {/* Base Image Display */}\n        <div className=\"bg-gradient-to-r from-lab-primary/10 to-lab-secondary/10 rounded-xl p-3 border border-lab-primary/20\">\n          <p className=\"text-xs text-gray-400 mb-1\">Base Image</p>\n          <p className=\"text-sm font-semibold text-white capitalize flex items-center gap-2\">\n            <span>{imageIcon}</span>\n            {imageName}\n          </p>\n          {node.image?.type === 'custom' && (\n            <p className=\"text-xs text-gray-500 mt-1 break-all\">{node.image.id}</p>\n          )}\n        </div>\n\n        {/* Resource Grid */}\n        <div className=\"grid grid-cols-3 gap-3 text-sm\">\n          <div className=\"bg-lab-darker/70 rounded-xl p-3 border border-lab-gray-light/30 hover:border-lab-primary/40 transition-colors\">\n            <p className=\"text-gray-400 text-xs mb-1.5 uppercase tracking-wide\">CPU</p>\n            <p className=\"text-white font-bold text-lg\">{node.resources.cpus || node.resources.cpu || 2}</p>\n            <p className=\"text-xs text-gray-500\">cores</p>\n          </div>\n          <div className=\"bg-lab-darker/70 rounded-xl p-3 border border-lab-gray-light/30 hover:border-lab-primary/40 transition-colors\">\n            <p className=\"text-gray-400 text-xs mb-1.5 uppercase tracking-wide\">RAM</p>\n            <p className=\"text-white font-bold text-lg\">{node.resources.ram}</p>\n            <p className=\"text-xs text-gray-500\">MB</p>\n          </div>\n          <div className=\"bg-lab-darker/70 rounded-xl p-3 border border-lab-gray-light/30 hover:border-lab-primary/40 transition-colors\">\n            <p className=\"text-gray-400 text-xs mb-1.5 uppercase tracking-wide\">Disk</p>\n            <p className=\"text-white font-bold text-lg\">{node.resources.disk || 10}</p>\n            <p className=\"text-xs text-gray-500\">GB</p>\n          </div>\n        </div>\n\n        {node.vncPort && (\n          <div className=\"bg-lab-accent/10 border border-lab-accent/30 rounded-xl p-3 text-xs\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-400 uppercase tracking-wide\">VNC Port</span>\n              <span className=\"text-lab-accent font-mono font-bold text-sm\">{node.vncPort}</span>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Actions */}\n      <div className=\"p-5 bg-lab-darker/50 border-t border-lab-gray-light space-y-3\">\n        {node.status === 'running' && (\n          <>\n            <Button\n              variant=\"primary\"\n              className=\"w-full\"\n              onClick={() => onConnect(node)}\n              icon={<span>üñ•Ô∏è</span>}\n            >\n              Connect Console\n            </Button>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"secondary\"\n                size=\"sm\"\n                className=\"flex-1\"\n                onClick={() => handleAction(() => onStop(node.id), 'stop')}\n                loading={loading === 'stop'}\n              >\n                Stop\n              </Button>\n              <Button\n                variant=\"danger\"\n                size=\"sm\"\n                onClick={handleWipeClick}\n                loading={loading === 'wipe'}\n                title=\"Reset VM - Wipes all data, keeps VM in list\"\n              >\n                {showWipeConfirm ? 'Confirm Wipe?' : 'Wipe'}\n              </Button>\n              <Button\n                variant=\"danger\"\n                size=\"sm\"\n                onClick={handleDeleteClick}\n                loading={loading === 'delete'}\n                title=\"Delete VM - Removes completely from system\"\n              >\n                {showDeleteConfirm ? 'Confirm?' : 'üóëÔ∏è'}\n              </Button>\n            </div>\n          </>\n        )}\n\n        {node.status === 'stopped' && (\n          <>\n            <div className=\"flex gap-2 mb-2\">\n              <Button\n                variant=\"primary\"\n                className=\"flex-1\"\n                onClick={() => handleAction(() => onStart(node.id), 'start')}\n                loading={loading === 'start'}\n                icon={<span>‚ñ∂Ô∏è</span>}\n              >\n                Start\n              </Button>\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"danger\"\n                size=\"sm\"\n                className=\"flex-1\"\n                onClick={handleWipeClick}\n                loading={loading === 'wipe'}\n                title=\"Reset VM - Wipes all data, keeps VM in list\"\n              >\n                {showWipeConfirm ? 'Confirm?' : 'Wipe Disk'}\n              </Button>\n              <Button\n                variant=\"danger\"\n                size=\"sm\"\n                className=\"flex-1\"\n                onClick={handleDeleteClick}\n                loading={loading === 'delete'}\n                title=\"Delete VM - Removes completely from system\"\n              >\n                {showDeleteConfirm ? 'Confirm?' : 'Delete VM'}\n              </Button>\n            </div>\n          </>\n        )}\n\n        {(node.status === 'starting' || node.status === 'stopping') && (\n          <Button variant=\"ghost\" className=\"w-full\" disabled>\n            Processing...\n          </Button>\n        )}\n\n        {node.status === 'error' && (\n          <div className=\"text-center\">\n            <p className=\"text-lab-danger text-sm mb-2\">‚ö†Ô∏è Error state</p>\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              onClick={() => handleAction(() => onWipe(node.id), 'wipe')}\n              loading={loading === 'wipe'}\n            >\n              Reset Node\n            </Button>\n          </div>\n        )}\n      </div>\n\n      {showWipeConfirm && (\n        <div className=\"px-4 py-2 bg-lab-danger/20 border-t border-lab-danger/50 text-xs text-center text-lab-danger\">\n          ‚ö†Ô∏è This will delete all data. Click again to confirm.\n        </div>\n      )}\n    </div>\n  );\n};",
    "frontend/components/StatusBadge.tsx": "import React from 'react';\nimport type { NodeStatus } from '../lib/types';\n\ninterface StatusBadgeProps {\n  status: NodeStatus;\n}\n\nexport const StatusBadge: React.FC<StatusBadgeProps> = ({ status }) => {\n  const statusConfig = {\n    running: {\n      label: 'Running',\n      color: 'bg-lab-accent text-white',\n      icon: '‚óè',\n      pulse: true,\n    },\n    stopped: {\n      label: 'Stopped',\n      color: 'bg-lab-gray-light text-gray-300',\n      icon: '‚óã',\n      pulse: false,\n    },\n    starting: {\n      label: 'Starting',\n      color: 'bg-lab-warning text-white',\n      icon: '‚óê',\n      pulse: true,\n    },\n    stopping: {\n      label: 'Stopping',\n      color: 'bg-lab-warning text-white',\n      icon: '‚óë',\n      pulse: true,\n    },\n    error: {\n      label: 'Error',\n      color: 'bg-lab-danger text-white',\n      icon: '‚úï',\n      pulse: false,\n    },\n  };\n\n  const config = statusConfig[status];\n\n  return (\n    <span\n      className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-semibold ${config.color}`}\n    >\n      <span className={config.pulse ? 'animate-pulse-glow' : ''}>\n        {config.icon}\n      </span>\n      {config.label}\n    </span>\n  );\n};",
    "frontend/lib/api.ts": "import type {\n  Node,\n  CreateNodeRequest,\n  CreateNodeResponse,\n  StartNodeResponse,\n  StopNodeResponse,\n  WipeNodeResponse,\n  ListNodesResponse,\n  ApiResponse,\n  ImageCatalogueResponse,\n  ImageInfo,\n} from './types';\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001/api';\n\nclass ApiClient {\n  private baseUrl: string;\n\n  constructor(baseUrl: string = API_BASE_URL) {\n    this.baseUrl = baseUrl;\n  }\n\n  private async request<T>(\n    endpoint: string,\n    options: RequestInit = {}\n  ): Promise<ApiResponse<T>> {\n    try {\n      const response = await fetch(`${this.baseUrl}${endpoint}`, {\n        ...options,\n        headers: {\n          'Content-Type': 'application/json',\n          ...options.headers,\n        },\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: data.error || data.message || 'Request failed',\n        };\n      }\n\n      return {\n        success: true,\n        data,\n      };\n    } catch (error) {\n      console.error('API request failed:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Network error',\n      };\n    }\n  }\n\n  // List all nodes\n  async listNodes(): Promise<ApiResponse<ListNodesResponse>> {\n    return this.request<ListNodesResponse>('/nodes');\n  }\n\n  // Create new node\n  async createNode(data: CreateNodeRequest): Promise<ApiResponse<CreateNodeResponse>> {\n    // Transform frontend format to backend format\n    const backendRequest = {\n      name: data.name,\n      osType: data.imageType === 'base' ? data.baseImage : 'custom',\n      imageType: data.imageType,\n      customImageName: data.imageType === 'custom' ? data.customImageName : undefined,\n      resources: data.resources ? {\n        ram: data.resources.ram,\n        cpus: data.resources.cpu,\n      } : undefined,\n    };\n    \n    return this.request<CreateNodeResponse>('/nodes', {\n      method: 'POST',\n      body: JSON.stringify(backendRequest),\n    });\n  }\n\n  // Start node (boot QEMU VM with overlay)\n  async startNode(id: string): Promise<ApiResponse<StartNodeResponse>> {\n    return this.request<StartNodeResponse>(`/nodes/${id}/run`, {\n      method: 'POST',\n    });\n  }\n\n  // Stop node (shutdown QEMU VM)\n  async stopNode(id: string): Promise<ApiResponse<StopNodeResponse>> {\n    return this.request<StopNodeResponse>(`/nodes/${id}/stop`, {\n      method: 'POST',\n    });\n  }\n\n  // Wipe node (delete overlay and recreate from base)\n  async wipeNode(id: string): Promise<ApiResponse<WipeNodeResponse>> {\n    return this.request<WipeNodeResponse>(`/nodes/${id}/wipe`, {\n      method: 'POST',\n    });\n  }\n\n  // Delete node completely\n  async deleteNode(id: string): Promise<ApiResponse<{ message: string }>> {\n    return this.request<{ message: string }>(`/nodes/${id}`, {\n      method: 'DELETE',\n    });\n  }\n\n  // Get node details\n  async getNode(id: string): Promise<ApiResponse<Node>> {\n    return this.request<Node>(`/nodes/${id}`);\n  }\n\n  // Added image catalogue\n  async listImages(): Promise<ApiResponse<ImageCatalogueResponse>> {\n    return this.request<ImageCatalogueResponse>('/images');\n  }\n\n  // Added custom image upload helper\n  async uploadCustomImage(file: File): Promise<ApiResponse<{ image: ImageInfo }>> {\n    try {\n      const formData = new FormData();\n      formData.append('image', file);\n\n      const response = await fetch(`${this.baseUrl}/images/custom`, {\n        method: 'POST',\n        body: formData,\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: data.error || 'Upload failed',\n        };\n      }\n\n      return {\n        success: true,\n        data,\n      };\n    } catch (error) {\n      console.error('Upload failed:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Network error',\n      };\n    }\n  }\n}\n\nexport const apiClient = new ApiClient();",
    "frontend/lib/mockData.ts": "import type { Node, BaseImage } from './types';\n\n// Available base images - Cloud images that work perfectly with QEMU\nexport const baseImages: BaseImage[] = [\n  {\n    id: 'ubuntu-24-lts',\n    name: 'Ubuntu 24.04 LTS',\n    type: 'ubuntu',\n    size: '596 MB',\n    description: 'Ubuntu Noble Server Cloud Image - Latest LTS release',\n    available: true,\n  },\n  {\n    id: 'debian-13',\n    name: 'Debian 13 (Trixie)',\n    type: 'debian',\n    size: '387 MB',\n    description: 'Debian 13 NoCloud Image - Stable and reliable',\n    available: true,\n  },\n  {\n    id: 'alpine-3',\n    name: 'Alpine Linux 3.x',\n    type: 'alpine',\n    size: '137 MB',\n    description: 'Alpine Linux Cloud Image - Lightweight and secure',\n    available: true,\n  },\n];\n\n// Mock nodes for development\nexport const mockNodes: Node[] = [\n  {\n    id: '1',\n    name: 'ubuntu-dev-1',\n    status: 'running',\n    osType: 'ubuntu',\n    baseImage: 'ubuntu',\n    vncPort: 5900,\n    guacUrl: 'http://localhost:8081/guacamole/#/client/MQBjAHBvc3RncmVzcWw',\n    guacConnectionId: 1,\n    overlayPath: '/vms/ubuntu_node_1.qcow2',\n    resources: {\n      cpu: 2,\n      cpus: 2,\n      ram: 2048,\n      disk: 10,\n    },\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  {\n    id: '2',\n    name: 'alpine-test-1',\n    status: 'stopped',\n    osType: 'alpine',\n    baseImage: 'alpine',\n    vncPort: null,\n    guacUrl: null,\n    guacConnectionId: null,\n    overlayPath: '/vms/alpine_node_1.qcow2',\n    resources: {\n      cpu: 1,\n      cpus: 1,\n      ram: 1024,\n      disk: 5,\n    },\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n];",
    "frontend/lib/types.ts": "// Node status types\nexport type NodeStatus = 'running' | 'stopped' | 'starting' | 'stopping' | 'error';\n\n// Base image types\nexport type BaseImageType = 'ubuntu' | 'alpine' | 'debian' | 'fedora' | 'arch';\nexport type ImageSourceType = 'base' | 'custom';\n\nexport interface BaseImage {\n  id: string;\n  name: string;\n  type: BaseImageType;\n  size: string;\n  description: string;\n  available: boolean;\n}\n\nexport interface NodeImage {\n  type: ImageSourceType;\n  id: string;\n  path: string;\n  sizeBytes: number;\n  size: string;\n  name?: string;\n  description?: string;\n}\n\nexport interface ImageInfo extends NodeImage {\n  available: boolean;\n  error?: string;\n  uploadedAt?: string;\n}\n\nexport interface ImageCatalogueResponse {\n  baseImages: ImageInfo[];\n  customImages: ImageInfo[];\n}\n\n// Node interface\nexport interface Node {\n  id: string;\n  name: string;\n  status: NodeStatus;\n  osType: BaseImageType | 'custom'; // Changed from baseImage to match backend\n  baseImage?: BaseImageType; // Keep for backward compatibility\n  image?: NodeImage | null;\n  vncPort: number | null;\n  guacUrl: string | null;\n  guacConnectionId: number | null;\n  overlayPath: string;\n  resources: {\n    cpu?: number; // cores (for compatibility)\n    cpus: number; // cores (main field)\n    ram: number; // MB\n    disk?: number; // GB\n  };\n  createdAt: string;\n  updatedAt: string;\n}\n\n// API response types\nexport interface ApiResponse<T = any> {\n  success: boolean;\n  data?: T;\n  error?: string;\n  message?: string;\n}\n\nexport interface CreateNodeRequest {\n  name?: string;\n  imageType: ImageSourceType;\n  baseImage?: BaseImageType;\n  customImageName?: string;\n  resources?: {\n    cpu?: number;\n    ram?: number;\n    disk?: number;\n  };\n}\n\nexport interface CreateNodeResponse {\n  id: string;\n  name: string;\n  status: NodeStatus;\n  overlayPath: string;\n  baseImage: BaseImageType;\n  createdAt: string;\n}\n\nexport interface StartNodeResponse {\n  id: string;\n  status: NodeStatus;\n  vncPort: number;\n  guacUrl: string;\n  guacConnectionId: number;\n  pid?: number;\n}\n\nexport interface StopNodeResponse {\n  id: string;\n  status: NodeStatus;\n}\n\nexport interface WipeNodeResponse {\n  id: string;\n  status: NodeStatus;\n  message: string;\n}\n\nexport interface ListNodesResponse {\n  nodes: Node[];\n  count: number;\n}",
    "frontend/.env.example": "# API Configuration\nNEXT_PUBLIC_API_URL=http://localhost:3001/api\n\n# Guacamole Configuration\nNEXT_PUBLIC_GUACAMOLE_URL=http://localhost:8081/guacamole",
    "frontend/Dockerfile": "FROM node:18-alpine AS builder\n\nWORKDIR /app\n\n# Copy package files\nCOPY package*.json ./\n\n# Install all dependencies (including dev)\nRUN npm ci\n\n# Copy application code\nCOPY . .\n\n# Build the application\nRUN npm run build\n\n# Production image\nFROM node:18-alpine\n\nWORKDIR /app\n\n# Copy package files\nCOPY package*.json ./\n\n# Install only production dependencies\nRUN npm ci --only=production\n\n# Copy built application from builder\nCOPY --from=builder /app/.next ./.next\nCOPY --from=builder /app/public ./public\nCOPY --from=builder /app/next.config.js ./\nCOPY --from=builder /app/package.json ./\n\n# Expose port\nEXPOSE 3000\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \\\n  CMD node -e \"require('http').get('http://localhost:3000', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})\"\n\n# Start Next.js server\nCMD [\"npm\", \"start\"]",
    "frontend/next-env.d.ts": "/// <reference types=\"next\" />\n/// <reference types=\"next/image-types/global\" />\n/// <reference path=\"./.next/types/routes.d.ts\" />\n\n// NOTE: This file should not be edited\n// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.",
    "frontend/next.config.js": "/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  reactStrictMode: true,\n  output: 'standalone',\n  serverExternalPackages: ['@xterm/xterm', '@xterm/addon-fit'],\n  webpack: (config, { isServer }) => {\n    if (!isServer) {\n      config.resolve.fallback = {\n        ...config.resolve.fallback,\n        fs: false,\n        net: false,\n        tls: false,\n      };\n    }\n    return config;\n  },\n}\n\nmodule.exports = nextConfig",
    "frontend/package.json": "{\n  \"name\": \"sandlabx-frontend\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"description\": \"SandLabX Network Lab Frontend\",\n  \"scripts\": {\n    \"dev\": \"next dev -p 3000\",\n    \"build\": \"next build\",\n    \"start\": \"next start -p 3000\",\n    \"lint\": \"next lint\"\n  },\n  \"dependencies\": {\n    \"@xterm/addon-fit\": \"^0.10.0\",\n    \"@xterm/xterm\": \"^5.4.0\",\n    \"next\": \"^15.5.5\",\n    \"react\": \"^19.2.0\",\n    \"react-dom\": \"^19.2.0\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"24.7.2\",\n    \"@types/react\": \"18.3.26\",\n    \"@types/react-dom\": \"^18.3.7\",\n    \"autoprefixer\": \"^10.4.21\",\n    \"eslint\": \"9.39.1\",\n    \"eslint-config-next\": \"16.0.1\",\n    \"postcss\": \"^8.5.6\",\n    \"postcss-flexbugs-fixes\": \"^5.0.2\",\n    \"postcss-loader\": \"^8.2.0\",\n    \"postcss-preset-env\": \"^10.4.0\",\n    \"tailwindcss\": \"^3.4.1\",\n    \"typescript\": \"5.9.3\"\n  }\n}",
    "frontend/postcss.config.js": "module.exports = {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}",
    "frontend/tailwind.config.js": "/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n  content: [\n    './pages/**/*.{js,ts,jsx,tsx,mdx}',\n    './components/**/*.{js,ts,jsx,tsx,mdx}',\n    './app/**/*.{js,ts,jsx,tsx,mdx}',\n  ],\n  theme: {\n    extend: {\n      colors: {\n        'lab-dark': '#0a0e27',\n        'lab-darker': '#060914',\n        'lab-primary': '#00d9ff',\n        'lab-secondary': '#7b2cbf',\n        'lab-accent': '#10b981',\n        'lab-danger': '#ef4444',\n        'lab-warning': '#f59e0b',\n        'lab-gray': '#1e293b',\n        'lab-gray-light': '#334155',\n      },\n      fontFamily: {\n        mono: ['Fira Code', 'Courier New', 'monospace'],\n      },\n      animation: {\n        'pulse-glow': 'pulse-glow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',\n      },\n      keyframes: {\n        'pulse-glow': {\n          '0%, 100%': { opacity: '1' },\n          '50%': { opacity: '0.5' },\n        },\n      },\n    },\n  },\n  plugins: [],\n}",
    "frontend/tsconfig.json": "{\n  \"compilerOptions\": {\n    \"target\": \"es5\",\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"allowJs\": true,\n    \"skipLibCheck\": true,\n    \"strict\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"module\": \"esnext\",\n    \"moduleResolution\": \"bundler\",\n    \"resolveJsonModule\": true,\n    \"isolatedModules\": true,\n    \"jsx\": \"preserve\",\n    \"incremental\": true,\n    \"plugins\": [\n      {\n        \"name\": \"next\"\n      }\n    ],\n    \"baseUrl\": \".\",\n    \"paths\": {\n      \"@/*\": [\"./*\"],\n      \"@/components/*\": [\"./components/*\"],\n      \"@/lib/*\": [\"./lib/*\"],\n      \"@/app/*\": [\"./app/*\"]\n    }\n  },\n  \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\", \".next/types/**/*.ts\"],\n  \"exclude\": [\"node_modules\"]\n}",
    ".gitignore": "# Runtime logs and process IDs\n*.log\n*.pid\n\n./images\n\n# Node modules\nnode_modules/\n**/node_modules/\n\n# Environment variables\n.env\n.env.local\n.env.*.local\n!.env.example\n\n# Build outputs\nfrontend/.next/\nfrontend/out/\nfrontend/build/\nbackend/dist/\nbackend/build/\n\n# Runtime state\nbackend/nodes-state.json\n\n# PostgreSQL data\npgdata/\n\n# QEMU overlays (generated at runtime)\noverlays/*.qcow2\n!overlays/.gitkeep\n\n# OS files\n.DS_Store\nThumbs.db\n.directory\n\n# IDE files\n.vscode/\n.idea/\n*.swp\n*.swo\n*.swn\n.project\n.classpath\n.settings/\n\n# Temporary files\n*.tmp\n*.temp\n*.bak\n*~\n\n# Package manager\npackage-lock.json.bak\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\npnpm-debug.log*\n\n# Testing\ncoverage/\n*.coverage\n.nyc_output/\n.cache/\n\n# Docker\n*.tar\n.dockerignore\n\n# Git\n.git/\n.gitattributes\n\n# Development artifacts\nEVALUATION-*.md\nVERIFICATION-*.md\nFIXES.md\nWORKFLOW-*.md\nSYSTEM-*.md\nCLEANUP-*.md\n\n# macOS\n.AppleDouble\n.LSOverride\nIcon\n\n# Windows\nThumbs.db\nehthumbs.db\nDesktop.ini\n$RECYCLE.BIN/\n\n# Linux\n*~\n.fuse_hidden*\n.nfs*\n\n\n# VM Images and disk files\nimages/*.qcow2\nvms/*.qcow2",
    "CHEAT-SHEET.txt": "================================================================================\n  üöÄ SANDBOXLABS - COMMAND CHEAT SHEET\n================================================================================\n\nüìç LOCATION: /home/naki/Desktop/itsthatnewshit/sandboxlabs\n\n================================================================================\n  ‚ö° MAIN COMMANDS (RUN FROM ROOT)\n================================================================================\n\nSTART EVERYTHING:\n  ./run-all.sh\n\nSTOP EVERYTHING:\n  ./stop-all.sh\n\nCHECK STATUS:\n  ./status.sh\n\nQUICK TEST:\n  ./quick-test.sh\n\n================================================================================\n  üåê ACCESS URLS\n================================================================================\n\nFrontend UI:       http://localhost:3000\nBackend API:       http://localhost:3001/api\nAPI Health:        http://localhost:3001/api/health\nGuacamole:         http://localhost:8081/guacamole\n                   (Login: guacadmin / guacadmin)\n\n================================================================================\n  üìù VIEW LOGS\n================================================================================\n\nBackend Logs:      tail -f backend.log\nFrontend Logs:     tail -f frontend.log\nDocker Logs:       docker-compose logs -f\nAll Logs:          tail -f backend.log frontend.log\n\n================================================================================\n  üîß MANUAL CONTROL (IF NEEDED)\n================================================================================\n\nDocker Services:\n  docker-compose up -d          # Start\n  docker-compose down           # Stop\n  docker-compose ps             # Status\n  docker-compose logs -f        # Logs\n\nBackend API:\n  cd backend\n  npm install                   # Install dependencies\n  npm start                     # Start server\n  node server.js                # Start directly\n\nFrontend:\n  cd frontend\n  npm install                   # Install dependencies\n  npm run dev                   # Start dev server\n  npm run build                 # Build for production\n\n================================================================================\n  üß™ API TESTING\n================================================================================\n\nHealth Check:\n  curl http://localhost:3001/api/health\n\nList Nodes:\n  curl http://localhost:3001/api/nodes\n\nCreate Node:\n  curl -X POST http://localhost:3001/api/nodes \\\n    -H \"Content-Type: application/json\" \\\n    -d '{\"name\":\"my-node\"}'\n\nStart Node:\n  curl -X POST http://localhost:3001/api/nodes/<ID>/run\n\nStop Node:\n  curl -X POST http://localhost:3001/api/nodes/<ID>/stop\n\nWipe Node:\n  curl -X POST http://localhost:3001/api/nodes/<ID>/wipe\n\n================================================================================\n  üêõ TROUBLESHOOTING\n================================================================================\n\nKill All Processes:\n  pkill -f \"next dev\"\n  pkill -f \"node.*server\"\n  docker-compose down\n\nCheck Ports:\n  netstat -tlnp | grep 3000      # Frontend\n  netstat -tlnp | grep 3001      # Backend\n  netstat -tlnp | grep 8081      # Guacamole\n\nClean Restart:\n  ./stop-all.sh\n  docker-compose down\n  rm -f backend.pid frontend.pid\n  rm -f backend.log frontend.log\n  ./run-all.sh\n\n================================================================================\n  üìÇ IMPORTANT FILES\n================================================================================\n\nConfiguration:\n  backend/.env                  # Backend config\n  docker-compose.yml            # Docker services\n\nState Files:\n  backend/nodes-state.json      # Node state (auto-created)\n  backend.pid                   # Backend process ID\n  frontend.pid                  # Frontend process ID\n\nLogs:\n  backend.log                   # Backend output\n  frontend.log                  # Frontend output\n\n================================================================================\n  üìö DOCUMENTATION\n================================================================================\n\nQUICK-START.md              # Quick start guide (READ THIS FIRST!)\nREADME.md                   # Complete documentation\nIMPLEMENTATION-COMPLETE.md  # Project summary\nBACKEND-COMPLETE.md         # Backend details\nbackend/README.md           # Backend API docs\nfrontend/README.md          # Frontend docs\n\n================================================================================\n  üéØ TYPICAL WORKFLOW\n================================================================================\n\n1. Start Everything:\n   ./run-all.sh\n\n2. Wait 20 seconds for startup\n\n3. Open Browser:\n   http://localhost:3000\n\n4. Use the Application:\n   - Click \"Add Node\"\n   - Click \"Run\" to start VM\n   - Click \"Connect\" to open console\n   - Click \"Stop\" to shutdown\n   - Click \"Wipe\" to reset\n\n5. Check Status Anytime:\n   ./status.sh\n\n6. Stop When Done:\n   ./stop-all.sh\n\n================================================================================\n  üí° QUICK TIPS\n================================================================================\n\n‚úÖ Always run commands from: /home/naki/Desktop/itsthatnewshit/sandboxlabs\n‚úÖ Use ./run-all.sh for easiest startup\n‚úÖ Check ./status.sh if something seems wrong\n‚úÖ View logs with: tail -f backend.log\n‚úÖ Always stop with: ./stop-all.sh\n\n================================================================================\n  üöÄ ONE COMMAND SUMMARY\n================================================================================\n\ncd /home/naki/Desktop/itsthatnewshit/sandboxlabs && ./run-all.sh\n\n  ‚Üì Wait 20 seconds ‚Üì\n\nOpen: http://localhost:3000\n\n================================================================================",
    "docker-compose.yml": "services:\n  # PostgreSQL Database for Guacamole\n  postgres:\n    image: postgres:15-alpine\n    container_name: sandlabx-postgres\n    environment:\n      POSTGRES_DB: guacamole_db\n      POSTGRES_USER: guacamole\n      POSTGRES_PASSWORD: guacpass123\n    volumes:\n      - ./initdb-schema.sql:/docker-entrypoint-initdb.d/initdb.sql:ro\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - \"5432:5432\"\n    restart: unless-stopped\n    networks:\n      - sandlabx-network\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U guacamole -d guacamole_db\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  # Guacamole Daemon (VNC/RDP/SSH proxy)\n  guacd:\n    image: guacamole/guacd:latest\n    container_name: sandlabx-guacd\n    restart: unless-stopped\n    networks:\n      - sandlabx-network\n    healthcheck:\n      test: [\"CMD\", \"nc\", \"-z\", \"localhost\", \"4822\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  # Guacamole Web Application\n  guacamole:\n    image: guacamole/guacamole:latest\n    container_name: sandlabx-guacamole\n    environment:\n      GUACD_HOSTNAME: guacd\n      GUACD_PORT: 4822\n      POSTGRESQL_HOSTNAME: postgres\n      POSTGRESQL_DATABASE: guacamole_db\n      POSTGRESQL_USER: guacamole\n      POSTGRESQL_PASSWORD: guacpass123\n      GUACAMOLE_HOME: /guacamole-home\n    depends_on:\n      postgres:\n        condition: service_healthy\n      guacd:\n        condition: service_healthy\n    ports:\n      - \"8081:8080\"\n    restart: unless-stopped\n    networks:\n      - sandlabx-network\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8080/guacamole/\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # Backend API Server\n  backend:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile\n    container_name: sandlabx-backend\n    privileged: true\n    environment:\n      PORT: 3001\n      NODE_ENV: production\n      DB_HOST: postgres\n      DB_PORT: 5432\n      DB_NAME: guacamole_db\n      DB_USER: guacamole\n      DB_PASSWORD: guacpass123\n      GUAC_BASE_URL: http://guacamole:8080/guacamole\n      OVERLAYS_PATH: /overlays\n      VNC_START_PORT: 5900\n      QEMU_RAM: 2048\n      QEMU_CPUS: 2\n      STATE_FILE: /app/nodes-state.json\n      CUSTOM_IMAGES_PATH: /images/custom\n    volumes:\n      - ./images:/images\n      - overlays_data:/overlays\n      - backend_state:/app/state\n      - /dev:/dev\n    ports:\n      - \"3001:3001\"\n    depends_on:\n      postgres:\n        condition: service_healthy\n      guacamole:\n        condition: service_healthy\n    restart: unless-stopped\n    networks:\n      - sandlabx-network\n    healthcheck:\n      test: [\"CMD\", \"node\", \"-e\", \"require('http').get('http://localhost:3001/api/health', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # Frontend Web UI\n  frontend:\n    build:\n      context: ./frontend\n      dockerfile: Dockerfile\n    container_name: sandlabx-frontend\n    environment:\n      NEXT_PUBLIC_API_URL: http://localhost:3001/api\n      NEXT_PUBLIC_GUACAMOLE_URL: http://localhost:8081/guacamole\n      NODE_ENV: production\n    ports:\n      - \"3000:3000\"\n    depends_on:\n      backend:\n        condition: service_healthy\n    restart: unless-stopped\n    networks:\n      - sandlabx-network\n    healthcheck:\n      test: [\"CMD\", \"wget\", \"--no-verbose\", \"--tries=1\", \"--spider\", \"http://localhost:3000\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\nnetworks:\n  sandlabx-network:\n    driver: bridge\n    name: sandlabx-network\n\nvolumes:\n  postgres_data:\n    name: sandlabx-postgres-data\n  overlays_data:\n    name: sandlabx-overlays\n  backend_state:\n    name: sandlabx-backend-state",
    "initdb-schema.sql": "--\n-- Licensed to the Apache Software Foundation (ASF) under one\n-- or more contributor license agreements.  See the NOTICE file\n-- distributed with this work for additional information\n-- regarding copyright ownership.  The ASF licenses this file\n-- to you under the Apache License, Version 2.0 (the\n-- \"License\"); you may not use this file except in compliance\n-- with the License.  You may obtain a copy of the License at\n--\n--   http://www.apache.org/licenses/LICENSE-2.0\n--\n-- Unless required by applicable law or agreed to in writing,\n-- software distributed under the License is distributed on an\n-- \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n-- KIND, either express or implied.  See the License for the\n-- specific language governing permissions and limitations\n-- under the License.\n--\n\n--\n-- Connection group types\n--\n\nCREATE TYPE guacamole_connection_group_type AS ENUM(\n    'ORGANIZATIONAL',\n    'BALANCING'\n);\n\n--\n-- Entity types\n--\n\nCREATE TYPE guacamole_entity_type AS ENUM(\n    'USER',\n    'USER_GROUP'\n);\n\n--\n-- Object permission types\n--\n\nCREATE TYPE guacamole_object_permission_type AS ENUM(\n    'READ',\n    'UPDATE',\n    'DELETE',\n    'ADMINISTER'\n);\n\n--\n-- System permission types\n--\n\nCREATE TYPE guacamole_system_permission_type AS ENUM(\n    'CREATE_CONNECTION',\n    'CREATE_CONNECTION_GROUP',\n    'CREATE_SHARING_PROFILE',\n    'CREATE_USER',\n    'CREATE_USER_GROUP',\n    'AUDIT',\n    'ADMINISTER'\n);\n\n--\n-- Guacamole proxy (guacd) encryption methods\n--\n\nCREATE TYPE guacamole_proxy_encryption_method AS ENUM(\n    'NONE',\n    'SSL'\n);\n\n--\n-- Table of connection groups. Each connection group has a name.\n--\n\nCREATE TABLE guacamole_connection_group (\n\n  connection_group_id   serial       NOT NULL,\n  parent_id             integer,\n  connection_group_name varchar(128) NOT NULL,\n  type                  guacamole_connection_group_type\n                        NOT NULL DEFAULT 'ORGANIZATIONAL',\n\n  -- Concurrency limits\n  max_connections          integer,\n  max_connections_per_user integer,\n  enable_session_affinity  boolean NOT NULL DEFAULT FALSE,\n\n  PRIMARY KEY (connection_group_id),\n\n  CONSTRAINT connection_group_name_parent\n    UNIQUE (connection_group_name, parent_id),\n\n  CONSTRAINT guacamole_connection_group_ibfk_1\n    FOREIGN KEY (parent_id)\n    REFERENCES guacamole_connection_group (connection_group_id)\n    ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_connection_group_parent_id\n    ON guacamole_connection_group(parent_id);\n\n--\n-- Table of connections. Each connection has a name, protocol, and\n-- associated set of parameters.\n-- A connection may belong to a connection group.\n--\n\nCREATE TABLE guacamole_connection (\n\n  connection_id       serial       NOT NULL,\n  connection_name     varchar(128) NOT NULL,\n  parent_id           integer,\n  protocol            varchar(32)  NOT NULL,\n  \n  -- Concurrency limits\n  max_connections          integer,\n  max_connections_per_user integer,\n\n  -- Connection Weight\n  connection_weight        integer,\n  failover_only            boolean NOT NULL DEFAULT FALSE,\n\n  -- Guacamole proxy (guacd) overrides\n  proxy_port              integer,\n  proxy_hostname          varchar(512),\n  proxy_encryption_method guacamole_proxy_encryption_method,\n\n  PRIMARY KEY (connection_id),\n\n  CONSTRAINT connection_name_parent\n    UNIQUE (connection_name, parent_id),\n\n  CONSTRAINT guacamole_connection_ibfk_1\n    FOREIGN KEY (parent_id)\n    REFERENCES guacamole_connection_group (connection_group_id)\n    ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_connection_parent_id\n    ON guacamole_connection(parent_id);\n\n--\n-- Table of base entities which may each be either a user or user group. Other\n-- tables which represent qualities shared by both users and groups will point\n-- to guacamole_entity, while tables which represent qualities specific to\n-- users or groups will point to guacamole_user or guacamole_user_group.\n--\n\nCREATE TABLE guacamole_entity (\n\n  entity_id     serial                  NOT NULL,\n  name          varchar(128)            NOT NULL,\n  type          guacamole_entity_type   NOT NULL,\n\n  PRIMARY KEY (entity_id),\n\n  CONSTRAINT guacamole_entity_name_scope\n    UNIQUE (type, name)\n\n);\n\n--\n-- Table of users. Each user has a unique username and a hashed password\n-- with corresponding salt. Although the authentication system will always set\n-- salted passwords, other systems may set unsalted passwords by simply not\n-- providing the salt.\n--\n\nCREATE TABLE guacamole_user (\n\n  user_id       serial       NOT NULL,\n  entity_id     integer      NOT NULL,\n\n  -- Optionally-salted password\n  password_hash bytea        NOT NULL,\n  password_salt bytea,\n  password_date timestamptz  NOT NULL,\n\n  -- Account disabled/expired status\n  disabled      boolean      NOT NULL DEFAULT FALSE,\n  expired       boolean      NOT NULL DEFAULT FALSE,\n\n  -- Time-based access restriction\n  access_window_start    time,\n  access_window_end      time,\n\n  -- Date-based access restriction\n  valid_from  date,\n  valid_until date,\n\n  -- Timezone used for all date/time comparisons and interpretation\n  timezone varchar(64),\n\n  -- Profile information\n  full_name           varchar(256),\n  email_address       varchar(256),\n  organization        varchar(256),\n  organizational_role varchar(256),\n\n  PRIMARY KEY (user_id),\n\n  CONSTRAINT guacamole_user_single_entity\n    UNIQUE (entity_id),\n\n  CONSTRAINT guacamole_user_entity\n    FOREIGN KEY (entity_id)\n    REFERENCES guacamole_entity (entity_id)\n    ON DELETE CASCADE\n\n);\n\n--\n-- Table of user groups. Each user group may have an arbitrary set of member\n-- users and member groups, with those members inheriting the permissions\n-- granted to that group.\n--\n\nCREATE TABLE guacamole_user_group (\n\n  user_group_id serial      NOT NULL,\n  entity_id     integer     NOT NULL,\n\n  -- Group disabled status\n  disabled      boolean     NOT NULL DEFAULT FALSE,\n\n  PRIMARY KEY (user_group_id),\n\n  CONSTRAINT guacamole_user_group_single_entity\n    UNIQUE (entity_id),\n\n  CONSTRAINT guacamole_user_group_entity\n    FOREIGN KEY (entity_id)\n    REFERENCES guacamole_entity (entity_id)\n    ON DELETE CASCADE\n\n);\n\n--\n-- Table of users which are members of given user groups.\n--\n\nCREATE TABLE guacamole_user_group_member (\n\n  user_group_id    integer       NOT NULL,\n  member_entity_id integer       NOT NULL,\n\n  PRIMARY KEY (user_group_id, member_entity_id),\n\n  -- Parent must be a user group\n  CONSTRAINT guacamole_user_group_member_parent\n    FOREIGN KEY (user_group_id)\n    REFERENCES guacamole_user_group (user_group_id) ON DELETE CASCADE,\n\n  -- Member may be either a user or a user group (any entity)\n  CONSTRAINT guacamole_user_group_member_entity\n    FOREIGN KEY (member_entity_id)\n    REFERENCES guacamole_entity (entity_id) ON DELETE CASCADE\n\n);\n\n--\n-- Table of sharing profiles. Each sharing profile has a name, associated set\n-- of parameters, and a primary connection. The primary connection is the\n-- connection that the sharing profile shares, and the parameters dictate the\n-- restrictions/features which apply to the user joining the connection via the\n-- sharing profile.\n--\n\nCREATE TABLE guacamole_sharing_profile (\n\n  sharing_profile_id    serial       NOT NULL,\n  sharing_profile_name  varchar(128) NOT NULL,\n  primary_connection_id integer      NOT NULL,\n\n  PRIMARY KEY (sharing_profile_id),\n\n  CONSTRAINT sharing_profile_name_primary\n    UNIQUE (sharing_profile_name, primary_connection_id),\n\n  CONSTRAINT guacamole_sharing_profile_ibfk_1\n    FOREIGN KEY (primary_connection_id)\n    REFERENCES guacamole_connection (connection_id)\n    ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_sharing_profile_primary_connection_id\n    ON guacamole_sharing_profile(primary_connection_id);\n\n--\n-- Table of connection parameters. Each parameter is simply a name/value pair\n-- associated with a connection.\n--\n\nCREATE TABLE guacamole_connection_parameter (\n\n  connection_id   integer       NOT NULL,\n  parameter_name  varchar(128)  NOT NULL,\n  parameter_value varchar(4096) NOT NULL,\n\n  PRIMARY KEY (connection_id,parameter_name),\n\n  CONSTRAINT guacamole_connection_parameter_ibfk_1\n    FOREIGN KEY (connection_id)\n    REFERENCES guacamole_connection (connection_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_connection_parameter_connection_id\n    ON guacamole_connection_parameter(connection_id);\n\n--\n-- Table of sharing profile parameters. Each parameter is simply\n-- name/value pair associated with a sharing profile. These parameters dictate\n-- the restrictions/features which apply to the user joining the associated\n-- connection via the sharing profile.\n--\n\nCREATE TABLE guacamole_sharing_profile_parameter (\n\n  sharing_profile_id integer       NOT NULL,\n  parameter_name     varchar(128)  NOT NULL,\n  parameter_value    varchar(4096) NOT NULL,\n\n  PRIMARY KEY (sharing_profile_id, parameter_name),\n\n  CONSTRAINT guacamole_sharing_profile_parameter_ibfk_1\n    FOREIGN KEY (sharing_profile_id)\n    REFERENCES guacamole_sharing_profile (sharing_profile_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_sharing_profile_parameter_sharing_profile_id\n    ON guacamole_sharing_profile_parameter(sharing_profile_id);\n\n--\n-- Table of arbitrary user attributes. Each attribute is simply a name/value\n-- pair associated with a user. Arbitrary attributes are defined by other\n-- extensions. Attributes defined by this extension will be mapped to\n-- properly-typed columns of a specific table.\n--\n\nCREATE TABLE guacamole_user_attribute (\n\n  user_id         integer       NOT NULL,\n  attribute_name  varchar(128)  NOT NULL,\n  attribute_value varchar(4096) NOT NULL,\n\n  PRIMARY KEY (user_id, attribute_name),\n\n  CONSTRAINT guacamole_user_attribute_ibfk_1\n    FOREIGN KEY (user_id)\n    REFERENCES guacamole_user (user_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_user_attribute_user_id\n    ON guacamole_user_attribute(user_id);\n\n--\n-- Table of arbitrary user group attributes. Each attribute is simply a\n-- name/value pair associated with a user group. Arbitrary attributes are\n-- defined by other extensions. Attributes defined by this extension will be\n-- mapped to properly-typed columns of a specific table.\n--\n\nCREATE TABLE guacamole_user_group_attribute (\n\n  user_group_id   integer       NOT NULL,\n  attribute_name  varchar(128)  NOT NULL,\n  attribute_value varchar(4096) NOT NULL,\n\n  PRIMARY KEY (user_group_id, attribute_name),\n\n  CONSTRAINT guacamole_user_group_attribute_ibfk_1\n    FOREIGN KEY (user_group_id)\n    REFERENCES guacamole_user_group (user_group_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_user_group_attribute_user_group_id\n    ON guacamole_user_group_attribute(user_group_id);\n\n--\n-- Table of arbitrary connection attributes. Each attribute is simply a\n-- name/value pair associated with a connection. Arbitrary attributes are\n-- defined by other extensions. Attributes defined by this extension will be\n-- mapped to properly-typed columns of a specific table.\n--\n\nCREATE TABLE guacamole_connection_attribute (\n\n  connection_id   integer       NOT NULL,\n  attribute_name  varchar(128)  NOT NULL,\n  attribute_value varchar(4096) NOT NULL,\n\n  PRIMARY KEY (connection_id, attribute_name),\n\n  CONSTRAINT guacamole_connection_attribute_ibfk_1\n    FOREIGN KEY (connection_id)\n    REFERENCES guacamole_connection (connection_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_connection_attribute_connection_id\n    ON guacamole_connection_attribute(connection_id);\n\n--\n-- Table of arbitrary connection group attributes. Each attribute is simply a\n-- name/value pair associated with a connection group. Arbitrary attributes are\n-- defined by other extensions. Attributes defined by this extension will be\n-- mapped to properly-typed columns of a specific table.\n--\n\nCREATE TABLE guacamole_connection_group_attribute (\n\n  connection_group_id integer       NOT NULL,\n  attribute_name      varchar(128)  NOT NULL,\n  attribute_value     varchar(4096) NOT NULL,\n\n  PRIMARY KEY (connection_group_id, attribute_name),\n\n  CONSTRAINT guacamole_connection_group_attribute_ibfk_1\n    FOREIGN KEY (connection_group_id)\n    REFERENCES guacamole_connection_group (connection_group_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_connection_group_attribute_connection_group_id\n    ON guacamole_connection_group_attribute(connection_group_id);\n\n--\n-- Table of arbitrary sharing profile attributes. Each attribute is simply a\n-- name/value pair associated with a sharing profile. Arbitrary attributes are\n-- defined by other extensions. Attributes defined by this extension will be\n-- mapped to properly-typed columns of a specific table.\n--\n\nCREATE TABLE guacamole_sharing_profile_attribute (\n\n  sharing_profile_id integer       NOT NULL,\n  attribute_name     varchar(128)  NOT NULL,\n  attribute_value    varchar(4096) NOT NULL,\n\n  PRIMARY KEY (sharing_profile_id, attribute_name),\n\n  CONSTRAINT guacamole_sharing_profile_attribute_ibfk_1\n    FOREIGN KEY (sharing_profile_id)\n    REFERENCES guacamole_sharing_profile (sharing_profile_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_sharing_profile_attribute_sharing_profile_id\n    ON guacamole_sharing_profile_attribute(sharing_profile_id);\n\n--\n-- Table of connection permissions. Each connection permission grants a user or\n-- user group specific access to a connection.\n--\n\nCREATE TABLE guacamole_connection_permission (\n\n  entity_id     integer NOT NULL,\n  connection_id integer NOT NULL,\n  permission    guacamole_object_permission_type NOT NULL,\n\n  PRIMARY KEY (entity_id, connection_id, permission),\n\n  CONSTRAINT guacamole_connection_permission_ibfk_1\n    FOREIGN KEY (connection_id)\n    REFERENCES guacamole_connection (connection_id) ON DELETE CASCADE,\n\n  CONSTRAINT guacamole_connection_permission_entity\n    FOREIGN KEY (entity_id)\n    REFERENCES guacamole_entity (entity_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_connection_permission_connection_id\n    ON guacamole_connection_permission(connection_id);\n\nCREATE INDEX guacamole_connection_permission_entity_id\n    ON guacamole_connection_permission(entity_id);\n\n--\n-- Table of connection group permissions. Each group permission grants a user\n-- or user group specific access to a connection group.\n--\n\nCREATE TABLE guacamole_connection_group_permission (\n\n  entity_id           integer NOT NULL,\n  connection_group_id integer NOT NULL,\n  permission          guacamole_object_permission_type NOT NULL,\n\n  PRIMARY KEY (entity_id, connection_group_id, permission),\n\n  CONSTRAINT guacamole_connection_group_permission_ibfk_1\n    FOREIGN KEY (connection_group_id)\n    REFERENCES guacamole_connection_group (connection_group_id) ON DELETE CASCADE,\n\n  CONSTRAINT guacamole_connection_group_permission_entity\n    FOREIGN KEY (entity_id)\n    REFERENCES guacamole_entity (entity_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_connection_group_permission_connection_group_id\n    ON guacamole_connection_group_permission(connection_group_id);\n\nCREATE INDEX guacamole_connection_group_permission_entity_id\n    ON guacamole_connection_group_permission(entity_id);\n\n--\n-- Table of sharing profile permissions. Each sharing profile permission grants\n-- a user or user group specific access to a sharing profile.\n--\n\nCREATE TABLE guacamole_sharing_profile_permission (\n\n  entity_id          integer NOT NULL,\n  sharing_profile_id integer NOT NULL,\n  permission         guacamole_object_permission_type NOT NULL,\n\n  PRIMARY KEY (entity_id, sharing_profile_id, permission),\n\n  CONSTRAINT guacamole_sharing_profile_permission_ibfk_1\n    FOREIGN KEY (sharing_profile_id)\n    REFERENCES guacamole_sharing_profile (sharing_profile_id) ON DELETE CASCADE,\n\n  CONSTRAINT guacamole_sharing_profile_permission_entity\n    FOREIGN KEY (entity_id)\n    REFERENCES guacamole_entity (entity_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_sharing_profile_permission_sharing_profile_id\n    ON guacamole_sharing_profile_permission(sharing_profile_id);\n\nCREATE INDEX guacamole_sharing_profile_permission_entity_id\n    ON guacamole_sharing_profile_permission(entity_id);\n\n--\n-- Table of system permissions. Each system permission grants a user or user\n-- group a system-level privilege of some kind.\n--\n\nCREATE TABLE guacamole_system_permission (\n\n  entity_id  integer NOT NULL,\n  permission guacamole_system_permission_type NOT NULL,\n\n  PRIMARY KEY (entity_id, permission),\n\n  CONSTRAINT guacamole_system_permission_entity\n    FOREIGN KEY (entity_id)\n    REFERENCES guacamole_entity (entity_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_system_permission_entity_id\n    ON guacamole_system_permission(entity_id);\n\n--\n-- Table of user permissions. Each user permission grants a user or user group\n-- access to another user (the \"affected\" user) for a specific type of\n-- operation.\n--\n\nCREATE TABLE guacamole_user_permission (\n\n  entity_id        integer NOT NULL,\n  affected_user_id integer NOT NULL,\n  permission       guacamole_object_permission_type NOT NULL,\n\n  PRIMARY KEY (entity_id, affected_user_id, permission),\n\n  CONSTRAINT guacamole_user_permission_ibfk_1\n    FOREIGN KEY (affected_user_id)\n    REFERENCES guacamole_user (user_id) ON DELETE CASCADE,\n\n  CONSTRAINT guacamole_user_permission_entity\n    FOREIGN KEY (entity_id)\n    REFERENCES guacamole_entity (entity_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_user_permission_affected_user_id\n    ON guacamole_user_permission(affected_user_id);\n\nCREATE INDEX guacamole_user_permission_entity_id\n    ON guacamole_user_permission(entity_id);\n\n--\n-- Table of user group permissions. Each user group permission grants a user\n-- or user group access to a another user group (the \"affected\" user group) for\n-- a specific type of operation.\n--\n\nCREATE TABLE guacamole_user_group_permission (\n\n  entity_id              integer NOT NULL,\n  affected_user_group_id integer NOT NULL,\n  permission             guacamole_object_permission_type NOT NULL,\n\n  PRIMARY KEY (entity_id, affected_user_group_id, permission),\n\n  CONSTRAINT guacamole_user_group_permission_affected_user_group\n    FOREIGN KEY (affected_user_group_id)\n    REFERENCES guacamole_user_group (user_group_id) ON DELETE CASCADE,\n\n  CONSTRAINT guacamole_user_group_permission_entity\n    FOREIGN KEY (entity_id)\n    REFERENCES guacamole_entity (entity_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_user_group_permission_affected_user_group_id\n    ON guacamole_user_group_permission(affected_user_group_id);\n\nCREATE INDEX guacamole_user_group_permission_entity_id\n    ON guacamole_user_group_permission(entity_id);\n\n--\n-- Table of connection history records. Each record defines a specific user's\n-- session, including the connection used, the start time, and the end time\n-- (if any).\n--\n\nCREATE TABLE guacamole_connection_history (\n\n  history_id           serial       NOT NULL,\n  user_id              integer      DEFAULT NULL,\n  username             varchar(128) NOT NULL,\n  remote_host          varchar(256) DEFAULT NULL,\n  connection_id        integer      DEFAULT NULL,\n  connection_name      varchar(128) NOT NULL,\n  sharing_profile_id   integer      DEFAULT NULL,\n  sharing_profile_name varchar(128) DEFAULT NULL,\n  start_date           timestamptz  NOT NULL,\n  end_date             timestamptz  DEFAULT NULL,\n\n  PRIMARY KEY (history_id),\n\n  CONSTRAINT guacamole_connection_history_ibfk_1\n    FOREIGN KEY (user_id)\n    REFERENCES guacamole_user (user_id) ON DELETE SET NULL,\n\n  CONSTRAINT guacamole_connection_history_ibfk_2\n    FOREIGN KEY (connection_id)\n    REFERENCES guacamole_connection (connection_id) ON DELETE SET NULL,\n\n  CONSTRAINT guacamole_connection_history_ibfk_3\n    FOREIGN KEY (sharing_profile_id)\n    REFERENCES guacamole_sharing_profile (sharing_profile_id) ON DELETE SET NULL\n\n);\n\nCREATE INDEX guacamole_connection_history_user_id\n    ON guacamole_connection_history(user_id);\n\nCREATE INDEX guacamole_connection_history_connection_id\n    ON guacamole_connection_history(connection_id);\n\nCREATE INDEX guacamole_connection_history_sharing_profile_id\n    ON guacamole_connection_history(sharing_profile_id);\n\nCREATE INDEX guacamole_connection_history_start_date\n    ON guacamole_connection_history(start_date);\n\nCREATE INDEX guacamole_connection_history_end_date\n    ON guacamole_connection_history(end_date);\n\nCREATE INDEX guacamole_connection_history_connection_id_start_date\n    ON guacamole_connection_history(connection_id, start_date);\n\n--\n-- User login/logout history\n--\n\nCREATE TABLE guacamole_user_history (\n\n  history_id           serial       NOT NULL,\n  user_id              integer      DEFAULT NULL,\n  username             varchar(128) NOT NULL,\n  remote_host          varchar(256) DEFAULT NULL,\n  start_date           timestamptz  NOT NULL,\n  end_date             timestamptz  DEFAULT NULL,\n\n  PRIMARY KEY (history_id),\n\n  CONSTRAINT guacamole_user_history_ibfk_1\n    FOREIGN KEY (user_id)\n    REFERENCES guacamole_user (user_id) ON DELETE SET NULL\n\n);\n\nCREATE INDEX guacamole_user_history_user_id\n    ON guacamole_user_history(user_id);\n\nCREATE INDEX guacamole_user_history_start_date\n    ON guacamole_user_history(start_date);\n\nCREATE INDEX guacamole_user_history_end_date\n    ON guacamole_user_history(end_date);\n\nCREATE INDEX guacamole_user_history_user_id_start_date\n    ON guacamole_user_history(user_id, start_date);\n\n--\n-- User password history\n--\n\nCREATE TABLE guacamole_user_password_history (\n\n  password_history_id serial  NOT NULL,\n  user_id             integer NOT NULL,\n\n  -- Salted password\n  password_hash bytea        NOT NULL,\n  password_salt bytea,\n  password_date timestamptz  NOT NULL,\n\n  PRIMARY KEY (password_history_id),\n\n  CONSTRAINT guacamole_user_password_history_ibfk_1\n    FOREIGN KEY (user_id)\n    REFERENCES guacamole_user (user_id) ON DELETE CASCADE\n\n);\n\nCREATE INDEX guacamole_user_password_history_user_id\n    ON guacamole_user_password_history(user_id);\n\n--\n-- Licensed to the Apache Software Foundation (ASF) under one\n-- or more contributor license agreements.  See the NOTICE file\n-- distributed with this work for additional information\n-- regarding copyright ownership.  The ASF licenses this file\n-- to you under the Apache License, Version 2.0 (the\n-- \"License\"); you may not use this file except in compliance\n-- with the License.  You may obtain a copy of the License at\n--\n--   http://www.apache.org/licenses/LICENSE-2.0\n--\n-- Unless required by applicable law or agreed to in writing,\n-- software distributed under the License is distributed on an\n-- \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n-- KIND, either express or implied.  See the License for the\n-- specific language governing permissions and limitations\n-- under the License.\n--\n\n-- Create default user \"guacadmin\" with password \"guacadmin\"\nINSERT INTO guacamole_entity (name, type) VALUES ('guacadmin', 'USER');\nINSERT INTO guacamole_user (entity_id, password_hash, password_salt, password_date)\nSELECT\n    entity_id,\n    decode('CA458A7D494E3BE824F5E1E175A1556C0F8EEF2C2D7DF3633BEC4A29C4411960', 'hex'),  -- 'guacadmin'\n    decode('FE24ADC5E11E2B25288D1704ABE67A79E342ECC26064CE69C5B3177795A82264', 'hex'),\n    CURRENT_TIMESTAMP\nFROM guacamole_entity WHERE name = 'guacadmin' AND guacamole_entity.type = 'USER';\n\n-- Grant this user all system permissions\nINSERT INTO guacamole_system_permission (entity_id, permission)\nSELECT entity_id, permission::guacamole_system_permission_type\nFROM (\n    VALUES\n        ('guacadmin', 'CREATE_CONNECTION'),\n        ('guacadmin', 'CREATE_CONNECTION_GROUP'),\n        ('guacadmin', 'CREATE_SHARING_PROFILE'),\n        ('guacadmin', 'CREATE_USER'),\n        ('guacadmin', 'CREATE_USER_GROUP'),\n        ('guacadmin', 'ADMINISTER')\n) permissions (username, permission)\nJOIN guacamole_entity ON permissions.username = guacamole_entity.name AND guacamole_entity.type = 'USER';\n\n-- Grant admin permission to read/update/administer self\nINSERT INTO guacamole_user_permission (entity_id, affected_user_id, permission)\nSELECT guacamole_entity.entity_id, guacamole_user.user_id, permission::guacamole_object_permission_type\nFROM (\n    VALUES\n        ('guacadmin', 'guacadmin', 'READ'),\n        ('guacadmin', 'guacadmin', 'UPDATE'),\n        ('guacadmin', 'guacadmin', 'ADMINISTER')\n) permissions (username, affected_username, permission)\nJOIN guacamole_entity          ON permissions.username = guacamole_entity.name AND guacamole_entity.type = 'USER'\nJOIN guacamole_entity affected ON permissions.affected_username = affected.name AND guacamole_entity.type = 'USER'\nJOIN guacamole_user            ON guacamole_user.entity_id = affected.entity_id;",
    "quick-test.sh": "#!/bin/bash\n# Quick test to verify everything is working\n\necho \"Testing Backend API...\"\ncurl -s http://localhost:3001/api/health | jq '.' 2>/dev/null || echo \"Backend not responding\"\n\necho \"\"\necho \"Testing Frontend...\"\ncurl -s -o /dev/null -w \"HTTP Status: %{http_code}\\n\" http://localhost:3000\n\necho \"\"\necho \"Testing Guacamole...\"\ncurl -s -o /dev/null -w \"HTTP Status: %{http_code}\\n\" http://localhost:8081/guacamole/\n\necho \"\"\necho \"Creating test node...\"\ncurl -s -X POST http://localhost:3001/api/nodes \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\":\"test-node\"}' | jq '.' 2>/dev/null || echo \"Failed to create node\"\n\necho \"\"\necho \"Listing nodes...\"\ncurl -s http://localhost:3001/api/nodes | jq '.' 2>/dev/null || echo \"Failed to list nodes\"",
    "run-all.sh": "#!/bin/bash\n\n# üöÄ SandBoxLabs - ONE COMMAND TO RULE THEM ALL\n# This script starts EVERYTHING: Docker + Backend + Frontend\n\nset -e\n\nSCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)\"\ncd \"$SCRIPT_DIR\"\n\necho \"==================================================================\"\necho \"  üöÄ SandBoxLabs - Complete System Startup\"\necho \"==================================================================\"\necho \"\"\necho \"Starting all services in one command...\"\necho \"\"\n\n# Colors\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\n# Function to print colored messages\ninfo() { echo -e \"${BLUE}‚Ñπ${NC}  $1\"; }\nsuccess() { echo -e \"${GREEN}‚úÖ${NC} $1\"; }\nwarning() { echo -e \"${YELLOW}‚ö†${NC}  $1\"; }\nerror() { echo -e \"${RED}‚ùå${NC} $1\"; }\n\n# Check prerequisites\ninfo \"Checking prerequisites...\"\n\nif ! command -v docker &> /dev/null; then\n    error \"Docker is not installed!\"\n    exit 1\nfi\n\nif ! command -v docker-compose &> /dev/null; then\n    error \"Docker Compose is not installed!\"\n    exit 1\nfi\n\nif ! command -v node &> /dev/null; then\n    error \"Node.js is not installed!\"\n    exit 1\nfi\n\nsuccess \"Prerequisites check passed\"\necho \"\"\n\n# Step 1: Setup dependencies (if needed)\ninfo \"Step 1/4: Setting up dependencies...\"\n\nif [ ! -d \"backend/node_modules\" ]; then\n    info \"Installing backend dependencies...\"\n    cd backend\n    npm install --silent\n    cd ..\n    success \"Backend dependencies installed\"\nelse\n    success \"Backend dependencies already installed\"\nfi\n\nif [ ! -d \"frontend/node_modules\" ]; then\n    info \"Installing frontend dependencies...\"\n    cd frontend\n    npm install --silent\n    cd ..\n    success \"Frontend dependencies installed\"\nelse\n    success \"Frontend dependencies already installed\"\nfi\n\necho \"\"\n\n# Step 2: Start Docker services\ninfo \"Step 2/4: Starting Docker services (Guacamole, PostgreSQL, Guacd)...\"\ndocker-compose up -d\n\necho \"\"\ninfo \"Waiting for Docker services to be healthy (10 seconds)...\"\nsleep 10\nsuccess \"Docker services started\"\necho \"\"\n\n# Step 3: Start Backend in background\ninfo \"Step 3/4: Starting Backend API server...\"\n\n# Kill any existing backend process\npkill -f \"node.*server.js\" 2>/dev/null || true\n\ncd backend\nnohup node server.js > ../backend.log 2>&1 &\nBACKEND_PID=$!\ncd ..\n\n# Wait for backend to start\nsleep 3\n\n# Check if backend is running\nif kill -0 $BACKEND_PID 2>/dev/null; then\n    success \"Backend API started (PID: $BACKEND_PID)\"\n    echo \"$BACKEND_PID\" > backend.pid\nelse\n    error \"Failed to start backend!\"\n    error \"Check backend.log for details\"\n    exit 1\nfi\n\necho \"\"\n\n# Step 4: Start Frontend in background\ninfo \"Step 4/4: Starting Frontend development server...\"\n\n# Kill any existing frontend process\npkill -f \"next dev\" 2>/dev/null || true\n\ncd frontend\nnohup npm run dev > ../frontend.log 2>&1 &\nFRONTEND_PID=$!\ncd ..\n\n# Wait for frontend to start\nsleep 5\n\n# Check if frontend is running\nif kill -0 $FRONTEND_PID 2>/dev/null; then\n    success \"Frontend started (PID: $FRONTEND_PID)\"\n    echo \"$FRONTEND_PID\" > frontend.pid\nelse\n    error \"Failed to start frontend!\"\n    error \"Check frontend.log for details\"\n    exit 1\nfi\n\necho \"\"\necho \"==================================================================\"\necho \"  ‚úÖ ALL SERVICES STARTED SUCCESSFULLY!\"\necho \"==================================================================\"\necho \"\"\necho \"üåê Access your application:\"\necho \"\"\necho \"   Frontend UI:    http://localhost:3000\"\necho \"   Backend API:    http://localhost:3001/api\"\necho \"   API Health:     http://localhost:3001/api/health\"\necho \"   Guacamole:      http://localhost:8081/guacamole\"\necho \"                   (Login: guacadmin / guacadmin)\"\necho \"\"\necho \"==================================================================\"\necho \"\"\necho \"üìä Service Status:\"\necho \"\"\necho \"   ‚úÖ Docker Services: Running\"\ndocker-compose ps --format \"table {{.Name}}\\t{{.Status}}\" 2>/dev/null || docker-compose ps\necho \"\"\necho \"   ‚úÖ Backend API:     Running (PID: $BACKEND_PID)\"\necho \"   ‚úÖ Frontend:        Running (PID: $FRONTEND_PID)\"\necho \"\"\necho \"==================================================================\"\necho \"\"\necho \"üìù Logs:\"\necho \"\"\necho \"   Backend:  tail -f backend.log\"\necho \"   Frontend: tail -f frontend.log\"\necho \"   Docker:   docker-compose logs -f\"\necho \"\"\necho \"==================================================================\"\necho \"\"\necho \"üõë To stop all services, run:\"\necho \"\"\necho \"   ./stop-all.sh\"\necho \"\"\necho \"==================================================================\"\necho \"\"\necho \"üéâ System is ready! Open http://localhost:3000 in your browser\"\necho \"\"",
    "setup-all.sh": "#!/bin/bash\n\n# SandBoxLabs - Complete System Startup\n# This script starts all services: Docker Compose + Backend API + Frontend\n\nset -e\n\nSCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)\"\ncd \"$SCRIPT_DIR\"\n\necho \"=========================================\"\necho \" üöÄ SandBoxLabs - Complete Startup\"\necho \"=========================================\"\necho \"\"\n\n# Function to check if a command exists\ncommand_exists() {\n    command -v \"$1\" &> /dev/null\n}\n\n# Check Docker\nif ! command_exists docker; then\n    echo \"‚ùå Error: Docker is not installed\"\n    exit 1\nfi\n\nif ! command_exists docker-compose; then\n    echo \"‚ùå Error: Docker Compose is not installed\"\n    exit 1\nfi\n\n# Check Node.js\nif ! command_exists node; then\n    echo \"‚ùå Error: Node.js is not installed\"\n    exit 1\nfi\n\necho \"‚úÖ Prerequisites check passed\"\necho \"\"\n\n# 1. Start Docker services\necho \"1Ô∏è‚É£  Starting Docker services (Guacamole, PostgreSQL, Guacd)...\"\ndocker-compose up -d\n\necho \"   Waiting for services to be healthy...\"\nsleep 5\n\n# 2. Setup backend\necho \"\"\necho \"2Ô∏è‚É£  Setting up backend...\"\ncd backend\nif [ ! -d \"node_modules\" ]; then\n    echo \"   Installing backend dependencies...\"\n    npm install\nfi\n\n# 3. Setup frontend\necho \"\"\necho \"3Ô∏è‚É£  Setting up frontend...\"\ncd ../frontend\n\nif [ ! -d \"node_modules\" ]; then\n    echo \"   Installing frontend dependencies...\"\n    npm install\nfi\n\n# Ensure PostCSS configuration is correct for Tailwind v3\necho \"   Verifying PostCSS configuration...\"\nif ! grep -q \"tailwindcss:\" postcss.config.js; then\n    echo \"   Updating postcss.config.js for Tailwind CSS v3...\"\n    cat > postcss.config.js << 'EOF'\nmodule.exports = {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\nEOF\nfi\n\ncd ..\n\necho \"\"\necho \"=========================================\"\necho \" ‚úÖ Setup Complete!\"\necho \"=========================================\"\necho \"\"\necho \"üìã Next Steps:\"\necho \"\"\necho \"1. Start Backend API (Terminal 1):\"\necho \"   cd backend && npm start\"\necho \"\"\necho \"2. Start Frontend (Terminal 2):\"\necho \"   cd frontend && npm run dev\"\necho \"\"\necho \"3. Access the application:\"\necho \"   Frontend:  http://localhost:3000\"\necho \"   Backend:   http://localhost:3001/api\"\necho \"   Guacamole: http://localhost:8081/guacamole\"\necho \"\"\necho \"=========================================\"\necho \"\"\necho \"üí° Tip: Use 'docker-compose logs -f' to view Docker logs\"\necho \"\"",
    "status.sh": "#!/bin/bash\n\n# üìä SandBoxLabs - Check Status of All Services\n\nSCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)\"\ncd \"$SCRIPT_DIR\"\n\necho \"==================================================================\"\necho \"  üìä SandBoxLabs - Service Status\"\necho \"==================================================================\"\necho \"\"\n\n# Colors\nGREEN='\\033[0;32m'\nRED='\\033[0;31m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m'\n\nrunning() { echo -e \"${GREEN}‚úÖ RUNNING${NC}\"; }\nstopped() { echo -e \"${RED}‚ùå STOPPED${NC}\"; }\nunknown() { echo -e \"${YELLOW}‚ö†  UNKNOWN${NC}\"; }\n\n# Check Docker services\necho \"üê≥ Docker Services:\"\necho \"\"\nif docker-compose ps | grep -q \"Up\"; then\n    docker-compose ps\nelse\n    echo \"   ‚ùå Docker services are not running\"\n    echo \"   Start with: docker-compose up -d\"\nfi\necho \"\"\n\n# Check Backend\necho \"üîß Backend API (Port 3001):\"\nif [ -f backend.pid ]; then\n    BACKEND_PID=$(cat backend.pid)\n    if kill -0 $BACKEND_PID 2>/dev/null; then\n        echo -n \"   Status: \"\n        running\n        echo \"   PID: $BACKEND_PID\"\n        echo \"   URL: http://localhost:3001/api\"\n        \n        # Test if responding\n        if curl -s http://localhost:3001/api/health > /dev/null 2>&1; then\n            echo \"   Health: ‚úÖ Responding\"\n        else\n            echo \"   Health: ‚ö†Ô∏è  Not responding (still starting?)\"\n        fi\n    else\n        echo -n \"   Status: \"\n        stopped\n        echo \"   (PID file exists but process is dead)\"\n    fi\nelse\n    echo -n \"   Status: \"\n    stopped\n    echo \"   (No PID file found)\"\nfi\necho \"\"\n\n# Check Frontend\necho \"üé® Frontend (Port 3000):\"\nif [ -f frontend.pid ]; then\n    FRONTEND_PID=$(cat frontend.pid)\n    if kill -0 $FRONTEND_PID 2>/dev/null; then\n        echo -n \"   Status: \"\n        running\n        echo \"   PID: $FRONTEND_PID\"\n        echo \"   URL: http://localhost:3000\"\n        \n        # Test if responding\n        if curl -s http://localhost:3000 > /dev/null 2>&1; then\n            echo \"   Health: ‚úÖ Responding\"\n        else\n            echo \"   Health: ‚ö†Ô∏è  Not responding (still starting?)\"\n        fi\n    else\n        echo -n \"   Status: \"\n        stopped\n        echo \"   (PID file exists but process is dead)\"\n    fi\nelse\n    echo -n \"   Status: \"\n    stopped\n    echo \"   (No PID file found)\"\nfi\necho \"\"\n\n# Check Guacamole\necho \"üñ•Ô∏è  Guacamole (Port 8081):\"\nif curl -s http://localhost:8081/guacamole/ > /dev/null 2>&1; then\n    echo -n \"   Status: \"\n    running\n    echo \"   URL: http://localhost:8081/guacamole\"\n    echo \"   Login: guacadmin / guacadmin\"\nelse\n    echo -n \"   Status: \"\n    stopped\nfi\necho \"\"\n\necho \"==================================================================\"\necho \"\"\necho \"üìù Quick Commands:\"\necho \"\"\necho \"   View Backend Logs:  tail -f backend.log\"\necho \"   View Frontend Logs: tail -f frontend.log\"\necho \"   View Docker Logs:   docker-compose logs -f\"\necho \"\"\necho \"   Test Backend API:   curl http://localhost:3001/api/health\"\necho \"   Open Frontend:      xdg-open http://localhost:3000\"\necho \"   Open Guacamole:     xdg-open http://localhost:8081/guacamole\"\necho \"\"\necho \"   Stop All Services:  ./stop-all.sh\"\necho \"   Start All Services: ./run-all.sh\"\necho \"\"\necho \"==================================================================\"",
    "stop-all.sh": "#!/bin/bash\n\n# üõë SandBoxLabs - Stop All Services\n# This script stops EVERYTHING: Frontend + Backend + Docker\n\nset -e\n\nSCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)\"\ncd \"$SCRIPT_DIR\"\n\necho \"==================================================================\"\necho \"  üõë SandBoxLabs - Stopping All Services\"\necho \"==================================================================\"\necho \"\"\n\n# Colors\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m'\n\ninfo() { echo -e \"${YELLOW}‚ö†${NC}  $1\"; }\nsuccess() { echo -e \"${GREEN}‚úÖ${NC} $1\"; }\n\n# Stop Frontend\nif [ -f frontend.pid ]; then\n    FRONTEND_PID=$(cat frontend.pid)\n    info \"Stopping Frontend (PID: $FRONTEND_PID)...\"\n    kill $FRONTEND_PID 2>/dev/null || true\n    pkill -f \"next dev\" 2>/dev/null || true\n    rm frontend.pid\n    success \"Frontend stopped\"\nelse\n    info \"Frontend not running (no PID file)\"\n    pkill -f \"next dev\" 2>/dev/null || true\nfi\n\n# Stop Backend\nif [ -f backend.pid ]; then\n    BACKEND_PID=$(cat backend.pid)\n    info \"Stopping Backend API (PID: $BACKEND_PID)...\"\n    kill $BACKEND_PID 2>/dev/null || true\n    pkill -f \"node.*server.js\" 2>/dev/null || true\n    rm backend.pid\n    success \"Backend stopped\"\nelse\n    info \"Backend not running (no PID file)\"\n    pkill -f \"node.*server.js\" 2>/dev/null || true\nfi\n\n# Stop Docker services\ninfo \"Stopping Docker services...\"\ndocker-compose down\n\nsuccess \"Docker services stopped\"\n\necho \"\"\necho \"==================================================================\"\necho \"  ‚úÖ ALL SERVICES STOPPED\"\necho \"==================================================================\"\necho \"\"\necho \"To start again, run: ./run-all.sh\"\necho \"\"",
    "test-backend.sh": "#!/bin/bash\n\n# Quick Backend Test Script\n# Tests that the backend API is working correctly\n\necho \"=========================================\"\necho \" üß™ Backend API Test Suite\"\necho \"=========================================\"\necho \"\"\n\nAPI_URL=\"http://localhost:3001/api\"\n\n# Check if backend is running\necho \"1Ô∏è‚É£  Testing backend connectivity...\"\nresponse=$(curl -s -o /dev/null -w \"%{http_code}\" \"$API_URL/health\" 2>/dev/null)\n\nif [ \"$response\" != \"200\" ]; then\n    echo \"‚ùå Backend is not running!\"\n    echo \"   Please start backend: cd backend && npm start\"\n    exit 1\nfi\n\necho \"‚úÖ Backend is running\"\necho \"\"\n\n# Test health endpoint\necho \"2Ô∏è‚É£  Testing /api/health...\"\ncurl -s \"$API_URL/health\" | jq '.' 2>/dev/null || curl -s \"$API_URL/health\"\necho \"\"\necho \"\"\n\n# Test list nodes\necho \"3Ô∏è‚É£  Testing GET /api/nodes...\"\ncurl -s \"$API_URL/nodes\" | jq '.' 2>/dev/null || curl -s \"$API_URL/nodes\"\necho \"\"\necho \"\"\n\n# Test create node\necho \"4Ô∏è‚É£  Testing POST /api/nodes (create)...\"\nnode_response=$(curl -s -X POST \"$API_URL/nodes\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"test-node-'$(date +%s)'\", \"osType\": \"ubuntu\"}')\n\necho \"$node_response\" | jq '.' 2>/dev/null || echo \"$node_response\"\n\n# Extract node ID\nnode_id=$(echo \"$node_response\" | jq -r '.id' 2>/dev/null)\n\nif [ -z \"$node_id\" ] || [ \"$node_id\" == \"null\" ]; then\n    echo \"\"\n    echo \"‚ö†Ô∏è  Could not create node (might be missing base image)\"\n    echo \"   This is expected if base.qcow2 doesn't exist yet\"\nelse\n    echo \"\"\n    echo \"‚úÖ Created node: $node_id\"\n    echo \"\"\n    \n    # Test get specific node\n    echo \"5Ô∏è‚É£  Testing GET /api/nodes/$node_id...\"\n    curl -s \"$API_URL/nodes/$node_id\" | jq '.' 2>/dev/null || curl -s \"$API_URL/nodes/$node_id\"\n    echo \"\"\nfi\n\necho \"\"\necho \"=========================================\"\necho \" ‚úÖ Basic API Tests Complete\"\necho \"=========================================\"\necho \"\"\necho \"üìù Notes:\"\necho \"   - All API endpoints are responding\"\necho \"   - To test VM operations (run/stop/wipe), you need:\"\necho \"     1. Base image at: images/base.qcow2\"\necho \"     2. QEMU installed\"\necho \"   - See BACKEND-COMPLETE.md for setup instructions\"\necho \"\""
  }
}